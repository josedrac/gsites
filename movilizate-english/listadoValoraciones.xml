<?xml version="1.0" encoding="UTF-8" ?>
<Module>
  <ModulePrefs title="me-listadoValoraciones.xml" height="1100">
    <Require feature="idi"/>
    <Require feature="locked-domain" />
	  <Require feature="dynamic-height"/>
	  <Require feature="setprefs" />
  </ModulePrefs>
  <Content type="html">
    <![CDATA[

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">

     <style type="text/css">
        /* @group fonts */
        @font-face {
            font-family: 'BBVA Web Light';
            src:url('https://cdn.rawgit.com/sopraux/gsites/v1.0/movilidadGeografica/fonts/web-light/web-light.eot');
            src:url('https://cdn.rawgit.com/sopraux/gsites/v1.0/movilidadGeografica/fonts/web-light/web-light.eot?iefix') format("embedded-opentype"),
            url('https://cdn.rawgit.com/sopraux/gsites/v1.0/movilidadGeografica/fonts/web-light/web-light.woff') format("woff"),
            url('https://cdn.rawgit.com/sopraux/gsites/v1.0/movilidadGeografica/fonts/web-light/web-light.ttf') format("truetype"),
            url('https://cdn.rawgit.com/sopraux/gsites/v1.0/movilidadGeografica/fonts/web-light/web-light.svg#BBVA Web Light') format("svg");
            font-style: normal;
            font-weight: normal;
        }
        @font-face {
            font-family: 'BBVA Web Book';
            src:url('https://cdn.rawgit.com/sopraux/gsites/v1.0/movilidadGeografica/fonts/web-book/web-book.eot');
            src:url('https://cdn.rawgit.com/sopraux/gsites/v1.0/movilidadGeografica/fonts/web-book/web-book.eot?iefix') format("embedded-opentype"),
            url('https://cdn.rawgit.com/sopraux/gsites/v1.0/movilidadGeografica/fonts/web-book/web-book.woff') format("woff"),
            url('https://cdn.rawgit.com/sopraux/gsites/v1.0/movilidadGeografica/fonts/web-book/web-book.ttf') format("truetype"),
            url('https://cdn.rawgit.com/sopraux/gsites/v1.0/movilidadGeografica/fonts/web-book/web-book.svg#BBVA Web Book') format("svg");
            font-style: normal;
            font-weight: normal;
        }
        @font-face {
            font-family: 'BBVA Web Medium';
            src:url('https://cdn.rawgit.com/sopraux/gsites/v1.0/movilidadGeografica/fonts/web-medium/web-medium.eot');
            src:url('https://cdn.rawgit.com/sopraux/gsites/v1.0/movilidadGeografica/fonts/web-medium/web-medium.eot?iefix') format("embedded-opentype"),
            url('https://cdn.rawgit.com/sopraux/gsites/v1.0/movilidadGeografica/fonts/web-medium/web-medium.woff') format("woff"),
            url('https://cdn.rawgit.com/sopraux/gsites/v1.0/movilidadGeografica/fonts/web-medium/web-medium.ttf') format("truetype"),
            url('https://cdn.rawgit.com/sopraux/gsites/v1.0/movilidadGeografica/fonts/web-medium/web-medium.svg#BBVA Web Medium') format("svg");
            font-style: normal;
            font-weight: normal;
        }
        /* @end */
        hr {
            border: 0;
            height: 0;
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            border-bottom: 1px solid rgba(255, 255, 255, 0.3);
        }

        h2 {
            font-family: 'BBVA Web Light';
            color: #0065B7;
            font-size: 22px;
            font-weight: normal;
        }

        p {
            padding: 10px;
            font-family: "BBVA Web Light", Arial;
        }

        .valoracion {
            width:920px;
            font-size: 11px;
            font-family: "BBVA Web Book", Arial;
        }
        .valoracion table {
            width: 100%;
        }
        .headerTable {
            width: 920px;
            font-size: 11px;
            font-family: "BBVA Web Book", Arial;
            border-top: 1px solid #DDDDDD;
            border-bottom: 1px solid #DDDDDD;
            border-spacing: 0;
            background-color: #F8F8F5;
        }
        .headerTable td {
            padding: 10px !important;
            font-weight: bold;
        }
        .headerTable td.puntuaciones {
            border-left: 1px solid #DDDDDD;
            border-right: 1px solid #DDDDDD;
        }
        td span {
            display: inline-block;
            font-size: 11px;
            font-family: "BBVA Web Book", Arial;
        }
        .user, td.puntuaciones, td.media {
            padding: 15px 10px;
            width: 25%;
            vertical-align: text-top;
        }
        td.puntuaciones {
            width: 50%;
        }
        .valoracion .user {
            font-size: 12px;
            font-weight: bold;
            color: #0065B7;
        }
        .valoracion td.puntuaciones table{
            width: 100%;
        }
        .valoracion td.puntuaciones table span{
            width: 97px;
            display: inline-block;
            font-size: 11px;
            font-family: "BBVA Web Book", Arial;
        }

        .valoracion i {
            color: #0065B7;
            font-size: 12px;
            padding: 0 1px;
        }
        .valoracion i.empty {
            color: #C9C9C9;
        }

        .pager {
            height: 30px;
            text-align: center;
            width: 175px;
            display: table;
        }
        .pager ul {
            list-style: none;
            padding: 0;
            margin: 0;
            text-aling: center;
            display: table-cell;
            vertical-align: middle;
        }
        .pager ul li {
            display: inline;
            margin-left: 2px;
        }
        .pager ul li a {
            text-decoration: none;
            font-weight: bold;
            display: inline-table;
            width: 20px;
            height: 20px;
            text-align: center;
            border-radius: 4px;
            -moz-border-radius: 4px;
        }
        .pager span {
            margin-left: 4px;
            color: White;
            float: left;
        }
        .pager .btn {
            width: 40px;
            text-align: center;
            display: table-cell;
            vertical-align: middle;
        }
        .pager .disabled {
            color: #A0A0A0 !important;
            text-shadow: 1px 1px 1px #FFFFFF;
        }
        .black.normal{
            background-color: #FFFFFF;
            color: #0072C9;
            border: solid 1px #d2e5eb;
        }
        .black.active{
            background-color: #0072C9;
            color: #FFFFFF;
            border: solid 1px #0072C9;
        }
        table tr > td {
            width: 215px;
        }
     </style>

    <script type="text/javascript" src="https://www.google.com/jsapi"></script>
    <script src="https://code.jquery.com/jquery-1.11.3.min.js" type="text/javascript"></script>
    <script src="https://cdn.rawgit.com/sopraux/gsites/v1.0/movilidadGeografica/js/smartpaginator.js" type="text/javascript"></script>

     <script type="text/javascript">
        google.load('visualization', '1', {packages: ['table']});
     </script>

     <script type="text/javascript">

        var spreadsheetKey = '1MnJzf8uiCAVVAECx_6vvzc3vkRb6SNQdDg5NC2MQ7Z0',
        queryString = encodeURIComponent('SELECT *' + getQueryParameters() + ' ORDER BY B ASC'),
        query = new google.visualization.Query('https://spreadsheets.google.com/tq?key=' + spreadsheetKey + '&tq=' + queryString);

        function getSpreadsheet() {
            query.send(handleQueryResponse);
        }

        function handleQueryResponse(response) {
            if (response.isError()) {
                console.log('Error in query: ' + response.getMessage() + ' ' + response.getDetailedMessage());
                return;
            }
            var dataTable = response.getDataTable();
            dataTable.getNumberOfRows() ? printDataTable(dataTable) : document.getElementById('listadoValoraciones').innerHTML += "<p>No exiten valoraciones para este centro.</p>";
        }

        function pagination(elements) {
            $('#pagination').smartpaginator({
                totalrecords: elements,
                recordsperpage: 10,
                length: 4,
                datacontainer: 'valoraciones',
                dataelement: 'div.valoracion',
                initval: 0,
            });
        }


        function getQueryParameters() {
            var filter = "";
            var id = getParam('idCentro');

            if(id != "" && id > 0)
            filter += " WHERE A ="+ id;

            return filter;
        }

        function getParam(p){
          var params;
          if(gadgets.util.getUrlParameters().parent.split("?").length > 1){
            params = gadgets.util.getUrlParameters().parent.split("?")[1].split("&");
            for(var i=0; i<params.length; i++){
              if(params[i].split("=")[0] == p)
                return params[i].split("=")[1];
            }
          }
          return "";
        }

        function formatDate(date) {
            var dd = date.getDate();
            var mm = date.getMonth()+1; //January is 0!
            var yyyy = date.getFullYear();

            if(dd<10) {
                dd='0'+dd;
            }

            if(mm<10) {
                mm='0'+mm;
            }

            return dd+'/'+mm+'/'+yyyy;
        }


        function printDataTable(data) {
            var filas = data.getNumberOfRows();
            var html = "";

            html += '<div id="valoraciones" style=" display: block;width: auto;">';

            for(var i=0;i<filas;i++) {

                if (data.getValue(i,14) != null)
                    var date = formatDate( new Date(data.getValue(i,14)) );

                html += "<div class='valoracion'>";
                html += "<table><tr>";
                html += "  <td><table>";
                html += "    <tr class='user'><td><span>"+data.getValue(i,1)+"</span></td></tr>";
                if (data.getValue(i,12) != null) {
                    var edad_text = traducir(data.getValue(i,12));
                    if (edad_text !== 'Other')
                        edad_text += ' years';
                    html += "    <tr><td><span>Age: "+edad_text+"</span></td></tr>";
                }
                if (data.getValue(i,13) != null)
                    html += "    <tr><td><span>Course: "+traducir(data.getValue(i,13))+"</span></td></tr>";
                if (data.getValue(i,14) != null)
                    html += "    <tr><td><span>Evaluation date: "+date+"</span></td></tr>";
                html += "  </table></td>";
                html += "  <td class='puntuaciones'><table>";
                html += "    <tr><td><span>Teachers team</span>" + printRating(data.getValue(i,2)) + "</td><td><span>Out-of-school activities</span>" + printRating(data.getValue(i,5)) + "</td></tr>";
                html += "    <tr><td><span>Facilities</span>" + printRating(data.getValue(i,3)) + "</td><td><span>School cafeteria</span>" + printRating(data.getValue(i,6)) + "</td></tr>";
                html += "    <tr><td><span>Languages</span>" + printRating(data.getValue(i,4)) + "</td><td><span>Extended school hours</span>" + printRating(data.getValue(i,7)) + "</td></tr>";
                html += "  </table></td>";
                html += "  <td class='media'>" + printRating(data.getValue(i,8)) + "</td>";
                html += "</tr></table><hr>";
                html += "</div>";

            }
            html += "</div>";
            html += "<div id='pagination' style='margin: auto;'></div>";

            document.getElementById('listadoValoraciones').innerHTML += html;
            if(filas > 0)
            pagination(filas);
        }


        function traducir( phrase ) {
            if (phrase === 'Infantil')      return 'Pre-school';
            if (phrase === 'Primaria')      return 'Elementary';
            if (phrase === 'Secundaria')    return 'Secondary';
            if (phrase === 'Bachillerato')  return 'High school';
            if (phrase === 'No lo uso')     return 'I don\'t use it';
            if (phrase === 'No disponible') return 'Not available';
            if (phrase === 'Otro' || phrase === 'Otra')  return 'Other';
            return phrase;
        }


        function printRating(puntuacion) {
            var html = "";
            if ( isNaN(puntuacion) ) {
                html = "<span class='rating-text'>" + traducir(puntuacion) + "</span>";
            }
            else {
                for (var i = 1; i <= 5; i++) {
                    if(i <= puntuacion) {
                        html += "<i class='fa fa-star'></i>";
                    } else {
                        html += "<i class='fa fa-star empty'></i>";
                    }
                }
            }
            return html;
        }

        google.setOnLoadCallback(getSpreadsheet);

     </script>

     <h2>Users who have evaluated this center</h2>
     <table class="headerTable">
         <tr>
             <td class='user'>USER</td>
             <td class='puntuaciones'>RATING</td>
             <td class='media'>AVERAGE SCORE</td>
         </tr>
     </table>
     <div id="listadoValoraciones"></div>


   ]]>
  </Content>
</Module>
