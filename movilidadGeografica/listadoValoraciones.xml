<?xml version="1.0" encoding="UTF-8" ?>
<Module>
  <ModulePrefs title="MG-listadoValoraciones.xml" height="1000">
    <Require feature="idi"/>
    <Require feature="locked-domain" />
	  <Require feature="dynamic-height"/>
	  <Require feature="setprefs" />
  </ModulePrefs>
  <Content type="html">
    <![CDATA[

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">

    <style type="text/css">
      /* @group fonts */
      @font-face {
        font-family: 'BBVA Web Light';
        src:url('https://rawgit.com/sopraux/gsites/master/movilidadGeografica/fonts/web-light/web-light.eot');
        src:url('https://rawgit.com/sopraux/gsites/master/movilidadGeografica/fonts/web-light/web-light.eot?iefix') format("embedded-opentype"),
          url('https://rawgit.com/sopraux/gsites/master/movilidadGeografica/fonts/web-light/web-light.woff') format("woff"),
          url('https://rawgit.com/sopraux/gsites/master/movilidadGeografica/fonts/web-light/web-light.ttf') format("truetype"),
          url('https://rawgit.com/sopraux/gsites/master/movilidadGeografica/fonts/web-light/web-light.svg#BBVA Web Light') format("svg");
        font-style: normal;
        font-weight: normal;
      }
      @font-face {
        font-family: 'BBVA Web Book';
        src:url('https://rawgit.com/sopraux/gsites/master/movilidadGeografica/fonts/web-book/web-book.eot');
        src:url('https://rawgit.com/sopraux/gsites/master/movilidadGeografica/fonts/web-book/web-book.eot?iefix') format("embedded-opentype"),
          url('https://rawgit.com/sopraux/gsites/master/movilidadGeografica/fonts/web-book/web-book.woff') format("woff"),
          url('https://rawgit.com/sopraux/gsites/master/movilidadGeografica/fonts/web-book/web-book.ttf') format("truetype"),
          url('https://rawgit.com/sopraux/gsites/master/movilidadGeografica/fonts/web-book/web-book.svg#BBVA Web Book') format("svg");
        font-style: normal;
        font-weight: normal;
      }
      @font-face {
        font-family: 'BBVA Web Medium';
        src:url('https://rawgit.com/sopraux/gsites/master/movilidadGeografica/fonts/web-medium/web-medium.eot');
        src:url('https://rawgit.com/sopraux/gsites/master/movilidadGeografica/fonts/web-medium/web-medium.eot?iefix') format("embedded-opentype"),
          url('https://rawgit.com/sopraux/gsites/master/movilidadGeografica/fonts/web-medium/web-medium.woff') format("woff"),
          url('https://rawgit.com/sopraux/gsites/master/movilidadGeografica/fonts/web-medium/web-medium.ttf') format("truetype"),
          url('https://rawgit.com/sopraux/gsites/master/movilidadGeografica/fonts/web-medium/web-medium.svg#BBVA Web Medium') format("svg");
        font-style: normal;
        font-weight: normal;
      }
      /* @end */
      hr {
        border: 0;
        height: 0;
        border-top: 1px solid rgba(0, 0, 0, 0.1);
        border-bottom: 1px solid rgba(255, 255, 255, 0.3);
      }

      h2 {
       font-family: 'BBVA Web Light';
       color: #0065B7;
       font-size: 22px;
       font-weight: normal;
      }

     .valoracion {
       width:920px;
       font-size: 11px;
       font-family: "BBVA Web Book", Arial;
     }
     .valoracion table {
       width: 100%;
     }
     .headerTable {
       width: 920px;
       font-size: 11px;
       font-family: "BBVA Web Book", Arial;
       border-top: 1px solid #DDDDDD;
       border-bottom: 1px solid #DDDDDD;
       border-spacing: 0;
       background-color: #F8F8F5;
     }
     .headerTable td {
       padding: 10px !important;
     }
     .headerTable td.puntuaciones {
       border-left: 1px solid #DDDDDD;
       border-right: 1px solid #DDDDDD;
     }
     td.user, td.puntuaciones, td.media {
       padding: 15px 10px;
       width: 25%;
     }
     td.puntuaciones {
       width: 50%;
     }
     .valoracion td.user {
       font-size: 12px;
       font-weight: bold;
       color: #0065B7;
     }
     .valoracion td.puntuaciones table{
       width: 100%;
     }
     .valoracion td.puntuaciones table span{
       width: 97px;
       display: inline-block;
     }

     .valoracion i {
       color: #0065B7;
       font-size: 12px;
       padding: 0 1px;
     }
     .valoracion i.empty {
       color: #C9C9C9;
     }

     .pager {
       height: 30px;
       text-align: center;
       width: 175px;
       display: table;
     }
     .pager ul {
       list-style: none;
       padding: 0;
       margin: 0;
       text-aling: center;
       display: table-cell;
       vertical-align: middle;
     }
     .pager ul li {
       display: inline;
       margin-left: 2px;
     }
     .pager ul li a {
       text-decoration: none;
       font-weight: bold;
       display: inline-table;
       width: 20px;
       height: 20px;
       text-align: center;
       border-radius: 4px;
       -moz-border-radius: 4px;
     }
     .pager span {
       margin-left: 4px;
       color: White;
       float: left;
     }
     .pager .btn {
       width: 40px;
       text-align: center;
       display: table-cell;
       vertical-align: middle;
     }
     .pager .disabled {
       color: #A0A0A0 !important;
       text-shadow: 1px 1px 1px #FFFFFF;
     }
     .black.normal{
       background-color: #FFFFFF;
       color: #0072C9;
       border: solid 1px #d2e5eb;
     }
     .black.active{
       background-color: #0072C9;
       color: #FFFFFF;
       border: solid 1px #0072C9;
     }
   </style>

   <script type="text/javascript" src="https://www.google.com/jsapi"></script>
   <script src="http://code.jquery.com/jquery-1.11.3.min.js" type="text/javascript"></script>
   <script src="https://rawgit.com/sopraux/gsites/master/movilidadGeografica/js/smartpaginator.js" type="text/javascript"></script>

   <script type="text/javascript">
     google.load('visualization', '1', {packages: ['table']});
   </script>

   <script type="text/javascript">

     var spreadsheetKey = '1MnJzf8uiCAVVAECx_6vvzc3vkRb6SNQdDg5NC2MQ7Z0',
       queryString = encodeURIComponent('SELECT *' + getQueryParameters() + ' ORDER BY B ASC'),
       query = new google.visualization.Query('https://spreadsheets.google.com/tq?key=' + spreadsheetKey + '&tq=' + queryString);

     function getSpreadsheet() {
       query.send(handleQueryResponse);
     }

     function handleQueryResponse(response) {
       if (response.isError()) {
         console.log('Error in query: ' + response.getMessage() + ' ' + response.getDetailedMessage());
         return;
       }
       var dataTable = response.getDataTable();
       dataTable.getNumberOfRows() ? printDataTable(dataTable) : console.log('spreadsheets is empty');
     }

     function pagination(elements) {
       $('#pagination').smartpaginator({
         totalrecords: elements,
         recordsperpage: 10,
         length: 4,
         datacontainer: 'valoraciones',
         dataelement: 'div.valoracion',
         initval: 0,
       });
     }


     function getQueryParameters() {
         var filter = "";
         var id = getParam('idCentro');

         if(id != "" && id > 0)
           filter += " WHERE A ="+ id;

         return filter;
     }

     function getParam(p){
         var params;
         if(gadgets.util.getUrlParameters().parent.split("?").length > 1){
             params = gadgets.util.getUrlParameters().parent.split("?")[1].split("&");
             for(var i=0; i<params.length; i++){
                 if(params[i].split("=")[0] == p)
                     return params[i].split("=")[1];
             }
         }
         return "";
     }


    function printDataTable(data) {
      var filas = data.getNumberOfRows();
      var html = "";

      html += '<div id="valoraciones" style=" display: block;width: auto;">';

      for(var i=0;i<filas;i++) {

         html += "<div class='valoracion'>";
         html += "<table><tr>";
         html += "  <td class='user'>"+data.getValue(i,1)+"</td>";
         html += "  <td class='puntuaciones'><table>";
         html += "    <tr><td><span>Profesorado</span>" + printRating(data.getValue(i,2)) + "</td><td><span>Extraescolares</span>" + printRating(data.getValue(i,5)) + "</td></tr>";
         html += "    <tr><td><span>Instalaciones</span>" + printRating(data.getValue(i,3)) + "</td><td><span>Comedor</span>" + printRating(data.getValue(i,6)) + "</td></tr>";
         html += "    <tr><td><span>Idiomas</span>" + printRating(data.getValue(i,4)) + "</td><td><span>Horario Ampliado</span>" + printRating(data.getValue(i,7)) + "</td></tr>";
         html += "  </table></td>";
         html += "  <td class='media'>" + printRating(data.getValue(i,8)) + "</td>";
         html += "</tr></table><hr>";
         html += "</div>";

       }
       html += "</div>";
       html += "<div id='pagination' style='margin: auto;'></div>";

      document.getElementById('listadoValoraciones').innerHTML += html;
      if(filas > 0)
         pagination(filas);
    }

    function printRating(puntuacion) {
      var html = "";
      for (var i = 1; i <= 5; i++) {
        if(i <= puntuacion) {
          html += "<i class='fa fa-star'></i>";
        } else {
          html += "<i class='fa fa-star empty'></i>";
        }
      }
      return html;
    }

    google.setOnLoadCallback(getSpreadsheet);

   </script>

   <h2>Usuarios que han valorado este centro</h2>
   <table class="headerTable">
     <tr>
       <td class='user'>USUARIO</td>
       <td class='puntuaciones'>VALORACIÃ“N</td>
       <td class='media'>NOTA MEDIA</td>
     </tr>
   </table>
   <div id="listadoValoraciones"></div>

   ]]>
  </Content>
</Module>
