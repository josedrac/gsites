<?xml version="1.0" encoding="UTF-8" ?>
<Module>
  <ModulePrefs title="MG-valorar.xml" height="550">
    <Require feature="idi"/>
    <Require feature="locked-domain" />
	  <Require feature="dynamic-height"/>
	  <Require feature="setprefs" />
  </ModulePrefs>
  <Content type="html">
    <![CDATA[

      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">

	    <style type="text/css">
        /* @group fonts */
        @font-face {
          font-family: 'BBVA Web Light';
          src:url('https://rawgit.com/sopraux/gsites/master/movilidadGeografica/fonts/web-light/web-light.eot');
          src:url('https://rawgit.com/sopraux/gsites/master/movilidadGeografica/fonts/web-light/web-light.eot?iefix') format("embedded-opentype"),
            url('https://rawgit.com/sopraux/gsites/master/movilidadGeografica/fonts/web-light/web-light.woff') format("woff"),
            url('https://rawgit.com/sopraux/gsites/master/movilidadGeografica/fonts/web-light/web-light.ttf') format("truetype"),
            url('https://rawgit.com/sopraux/gsites/master/movilidadGeografica/fonts/web-light/web-light.svg#BBVA Web Light') format("svg");
          font-style: normal;
          font-weight: normal;
        }
        @font-face {
          font-family: 'BBVA Web Book';
          src:url('https://rawgit.com/sopraux/gsites/master/movilidadGeografica/fonts/web-book/web-book.eot');
          src:url('https://rawgit.com/sopraux/gsites/master/movilidadGeografica/fonts/web-book/web-book.eot?iefix') format("embedded-opentype"),
            url('https://rawgit.com/sopraux/gsites/master/movilidadGeografica/fonts/web-book/web-book.woff') format("woff"),
            url('https://rawgit.com/sopraux/gsites/master/movilidadGeografica/fonts/web-book/web-book.ttf') format("truetype"),
            url('https://rawgit.com/sopraux/gsites/master/movilidadGeografica/fonts/web-book/web-book.svg#BBVA Web Book') format("svg");
          font-style: normal;
          font-weight: normal;
        }
        @font-face {
          font-family: 'BBVA Web Medium';
          src:url('https://rawgit.com/sopraux/gsites/master/movilidadGeografica/fonts/web-medium/web-medium.eot');
          src:url('https://rawgit.com/sopraux/gsites/master/movilidadGeografica/fonts/web-medium/web-medium.eot?iefix') format("embedded-opentype"),
            url('https://rawgit.com/sopraux/gsites/master/movilidadGeografica/fonts/web-medium/web-medium.woff') format("woff"),
            url('https://rawgit.com/sopraux/gsites/master/movilidadGeografica/fonts/web-medium/web-medium.ttf') format("truetype"),
            url('https://rawgit.com/sopraux/gsites/master/movilidadGeografica/fonts/web-medium/web-medium.svg#BBVA Web Medium') format("svg");
          font-style: normal;
          font-weight: normal;
        }
        /* @end */

         p, form {
           color: #434A58;
           font-size: 12px;
           font-family: Arial;
           margin: 0;
           padding: 0 15px;
         }

         button {
           background: #0079C1;
           background: -moz-linear-gradient(top, #0079C1 0%, #00559D 100%);
           background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#0079C1), color-stop(100%,#00559D));
           background: -webkit-linear-gradient(top, #0079C1 0%,#00559D 100%);
           background: -o-linear-gradient(top, #0079C1 0%,#00559D 100%);
           background: -ms-linear-gradient(top, #0079C1 0%,#00559D 100%);
           background: linear-gradient(to bottom, #0079C1 0%,#00559D 100%);
           -webkit-border-radius: 4px;
           -moz-border-radius: 4px;
           border-radius: 4px;
           text-align: center;
           vertical-align: middle;
           padding: 10px 15px;
           border: .1em solid #00559D;
           color: white;
           cursor: pointer;
           position: relative;
           overflow: visible;
           float: right;
           font-size: 14px;
           font-weight:bold;
         }

        # {
           color: red;
           margin-top: 10px;
           text-align: center;
           float: left;
           width: 100%;
         }

         .starrr {
           display: inline-block;
         }
         .starrr i {
           font-size: 24px;
           padding: 0 1px;
           cursor: pointer;
           color: #6AAD22;
         }
         .starrr i.empty {
           color: #C9C9C9;
         }

         span {
           font-size: 18px;
           width: 60px;
           font-family: 'BBVA Web Light';
           display: inline-block;
           width: 180px;
         }

         .valoracion, .media {
           padding: 15px;
         }

         .media {
           background-color: #F2F4F5;
           border-top: 1px solid #E5E5E5;
           border-bottom: 1px solid #D1D1D1;
         }
         .media #resultMedia {
           display: inline-block;
         }
         .media i {
           color: #0065B7;
           font-size: 24px;
            padding: 0 1px;
         }
         .media i.empty {
           color: #C9C9C9;
         }
	    </style>

      <p>
        Valora los siguientes aspectos del centro, siendo una estrella la puntuación mínima y cinco estrellas la puntuación máxima. Además tu e-mail quedará registrado asociado a este centro para que tus compañeros puedan ponerse en contacto contigo si lo necesitan.
      </p>
      <form action="#">
         <div class="valoracion"><span>Profesorado</span> <div class='starrr' data-connected-input='ratingPofesorado'></div></div>
         <div class="valoracion"><span>Instalaciones</span> <div class='starrr' data-connected-input='ratingInstalaciones'></div></div>
         <div class="valoracion"><span>Idiomas</span> <div class='starrr' data-connected-input='ratingIdioma'></div></div>
         <div class="valoracion"><span>Extraescolares</span> <div class='starrr' data-connected-input='ratingExtraescolares'></div></div>
         <div class="valoracion"><span>Comedor</span> <div class='starrr' data-connected-input='ratingComedor'></div></div>
         <div class="valoracion"><span>Horario ampliado</span> <div class='starrr' data-connected-input='ratingHorario'></div></div>
         <div class="media"><span>Nota media</span> <div id='resultMedia'><i class='fa fa-star'></i><i class='fa fa-star'></i><i class='fa fa-star'></i><i class='fa fa-star empty'></i><i class='fa fa-star empty'></i></div></div>
         <br /><br>
         <input type='hidden' value='3' name='ratingPofesorado'/>
         <input type='hidden' value='3' name='ratingInstalaciones'/>
         <input type='hidden' value='3' name='ratingIdioma'/>
         <input type='hidden' value='3' name='ratingExtraescolares'/>
         <input type='hidden' value='3' name='ratingComedor'/>
         <input type='hidden' value='3' name='ratingHorario'/>
         <input type='hidden' value='3' name='notaMedia'/>
         <button type="submit">Valorar</button>
      </form>

      <div id='error'></div>

      <script type="text/javascript" src="https://www.google.com/jsapi"></script>
      <script src="//code.jquery.com/jquery-1.11.3.min.js" type="text/javascript"></script>
      <script src="https://rawgit.com/sopraux/gsites/master/movilidadGeografica/js/starrr.min.js" type="text/javascript"></script>

   	  <script type="text/javascript">
        function getParam(p){
          var params;
          if(gadgets.util.getUrlParameters().parent.split("?").length > 1){
            params = gadgets.util.getUrlParameters().parent.split("?")[1].split("&");
            for(var i=0; i<params.length; i++){
              if(params[i].split("=")[0] == p)
                return params[i].split("=")[1];
            }
          }
          return "";
        }

        $(document).ready(function() {

          $(".starrr").click(function(event) {
            var sum = 0;
            var media = 0;
            var html = "";
            sum = parseInt($('input[name=ratingPofesorado]').val()) +
                  parseInt($('input[name=ratingInstalaciones]').val()) +
                  parseInt($('input[name=ratingIdioma]').val()) +
                  parseInt($('input[name=ratingExtraescolares]').val()) +
                  parseInt($('input[name=ratingComedor]').val()) +
                  parseInt($('input[name=ratingHorario]').val());
            media = Math.round(sum/6);
            for (var i = 1; i <= 5; i++) {
              if(i <= media) {
                html += "<i class='fa fa-star'></i>";
              } else {
                html += "<i class='fa fa-star empty'></i>";
              }
            }
            $('input[name=notaMedia]').val(media);
            $("#resultMedia").html(html);
          });

           $('form').submit(function(event) {
             var formData = {
               'idCentro'             : getParam('idCentro'),
               'nombreCentro'         : decodeURI(getParam('name')).replace("+", " "),
               'comunidad'            : decodeURI(getParam('comunidad')),
               'ratingPofesorado'	    : $('input[name=ratingPofesorado]').val(),
               'ratingInstalaciones'  : $('input[name=ratingInstalaciones]').val(),
               'ratingIdioma'	        : $('input[name=ratingIdioma]').val(),
               'ratingExtraescolares' : $('input[name=ratingExtraescolares]').val(),
               'ratingComedor'	      : $('input[name=ratingComedor]').val(),
               'ratingHorario'	      : $('input[name=ratingHorario]').val(),
               'notaMedia'	          : $('input[name=notaMedia]').val()
             };

             $.ajax({
               type      	: 'GET',
               url       	: 'https://script.google.com/a/macros/bbva.com/s/AKfycbxOVGcIftQBLR8lkOaZlARIERb55EhyU5XC5qkCQhhNi79rbbyO/exec',
               data      	: formData,
               dataType		: 'jsonp',
               crossDomain	: true,
               jsonpCallback: "on_result",
               success: function(data) {
                 return console.log(data);
               },
               error: function() {
                 return console.error(data);
               }
             });
             event.preventDefault();
           });

         });
  	  </script>

    ]]>
  </Content>
</Module>
