<?xml version="1.0" encoding="UTF-8" ?>
<Module>
  <ModulePrefs title="novedad.xml"
    description=""
    author_affiliation="Sopra">
    <Require feature="idi"/>
    <Require feature="locked-domain" />
	<Require feature="dynamic-height"/>
	<Require feature="setprefs" />
  </ModulePrefs>
	<UserPref name="_table_query_url" default_value="" display_name="Data source url (Ej:https://docs.google.com/spreadsheet/ccc?key=0AoYEewut2JmZdG5HM2VLTTdwQUlLdmhnMk1DLXBWZl)" required="true" />

 <Content type="html">
    <![CDATA[
	<script src="https://www.google.com/jsapi" type="text/javascript"></script>

	<style type="text/css">
	  /* @group fonts */
@font-face {
	font-family: 'BBVA Web Light';
	src:url('https://github.com/sopraux/gsites/raw/menu/evolucionaDigital/fonts/web-light/web-light.eot');
	src:url('https://github.com/sopraux/gsites/raw/menu/evolucionaDigital/fonts/web-light/web-light.eot?iefix') format("embedded-opentype"),
		url('https://github.com/sopraux/gsites/raw/menu/evolucionaDigital/fonts/web-light/web-light.woff') format("woff"),
		url('https://github.com/sopraux/gsites/raw/menu/evolucionaDigital/fonts/web-light/web-light.ttf') format("truetype"),
		url('https://github.com/sopraux/gsites/raw/menu/evolucionaDigital/fonts/web-light/web-light.svg#BBVA Web Light') format("svg");
	font-style: normal;
	font-weight: normal;
}

@font-face {
	font-family: 'BBVA Web Book';
	src:url('https://github.com/sopraux/gsites/raw/menu/evolucionaDigital/fonts/web-book/web-book.eot');
	src:url('https://github.com/sopraux/gsites/raw/menu/evolucionaDigital/fonts/web-book/web-book.eot?iefix') format("embedded-opentype"),
		url('https://github.com/sopraux/gsites/raw/menu/evolucionaDigital/fonts/web-book/web-book.woff') format("woff"),
		url('https://github.com/sopraux/gsites/raw/menu/evolucionaDigital/fonts/web-book/web-book.ttf') format("truetype"),
		url('https://github.com/sopraux/gsites/raw/menu/evolucionaDigital/fonts/web-book/web-book.svg#BBVA Web Book') format("svg");
	font-style: normal;
	font-weight: normal;
}

@font-face {
	font-family: 'BBVA Web Medium';
	src:url('https://github.com/sopraux/gsites/raw/menu/evolucionaDigital/fonts/web-medium/web-medium.eot');
	src:url('https://github.com/sopraux/gsites/raw/menu/evolucionaDigital/fonts/web-medium/web-medium.eot?iefix') format("embedded-opentype"),
		url('https://github.com/sopraux/gsites/raw/menu/evolucionaDigital/fonts/web-medium/web-medium.woff') format("woff"),
		url('https://github.com/sopraux/gsites/raw/menu/evolucionaDigital/fonts/web-medium/web-medium.ttf') format("truetype"),
		url('https://github.com/sopraux/gsites/raw/menu/evolucionaDigital/fonts/web-medium/web-medium.svg#BBVA Web Medium') format("svg");
	font-style: normal;
	font-weight: normal;
}

/* @end */

	#titlecomboVideo{
	margin-top:-9px;
	margin-left:-15px;
	}

	#titlecomboVideo h2{
	font-weight: normal;
	color:#0078D2;
	font-family:BBVA Web Light, Arial;
	font-size:22px;
	margin:9px 0px 10px 28px;
	}

	#comboVideo{
	    width:620px;
	    float:left;
	}
      #video-container{
   	    float:left;
		width:607px;
		height:504px;
		}

	  #video-container2{
	    float:left;
		width:607px;
		height:504px;
	  }

	  #urlVideo{
		float:right;
	    width:640px;
		height:427px;
		margin-right:4px;
		margin-top:5px;
	  }
	  #urlVideo2{
		float:right;
	    width:640px;
		height:427px;
		margin-right:4px;
		margin-top:5px;
	  }

	  #TagVideo{
	   color:#000;
	   margin-bottom:11px;
	   margin-left:11px;
	   margin-top:-7px;
		//font-weight:bold;
	  }
	  #TagVideo2{
	    color:#000;
		margin-bottom:11px;
		margin-left: 11px;
		margin-top: 0px;
		//font-weight:bold;
	  }

      #titleVideo{
	  color:#0078D2;
	  font-family:BBVA Web Book, Arial;
	  font-size:18px;
	  margin-bottom:20px;
	  width:238px;
	  margin-left:7px;
	  margin-top:5px;

	  }
	  #titleVideo2{
		color:#0078D2;
		font-size:18px;
	    font-family:BBVA Web Book, Arial;
		margin-bottom:20px;
		width:238px;
		margin-left:7px;
		margin-top:5px;
	  }
	  #textVideo{
	    color:#0065B7;
		font-size:11px;
		font-family:BBVA Web Medium, Arial;
		height:40px;
		width:620px;
		margin-top: 15px;
		margin-left: -5px;
		padding:5px 5px;
		float:left;
		background:url('https://github.com/sopraux/gsites/raw/menu/evolucionaDigital/img/addinfo.png')no-repeat;
	  }
	  #textVideo2{
		color:#0065B7;
		font-size:11px;
		font-family:BBVA Web Medium, Arial;
		height:40px;
		width:620px;
		margin-top: 15px;
		margin-left: 7px;
		float:left;
		background:url('https://github.com/sopraux/gsites/raw/menu/evolucionaDigital/img/addinfo.png')no-repeat;
	    }
	#infoVideo{
	float:left;
		width:640px;
		height:427px;
		margin-left:15px;
		margin-top:-9px;
	}
	#infoVideo2{
		float:left;
		width:600px;
		height:160px;
		margin-left:15px;
		margin-top:-9px;
		}
	hr{
    width:610px;
	margin-bottom:20px;
	margin-left:-1px;
	color:#DCDCDC;
	}
	#allcontent{

	-webkit-border-radius: .2em;
	-moz-border-radius: .2em;
	border-radius: .2em;
	height: 2em;
	padding-left: 1.4em;
	padding-right: 2.4em;
	float:left;
	margin-left:10px;
	width:90px;
	margin-top:25px;

	}
	 #allcontent a{
	float:left;

	position: relative;
	top: -1px;
	margin-right: 0;
	text-decoration:none;
	color:#FFF;
	font-family: BBVA Web Medium, Arial;
	font-size:12px;
	margin-left:-16px;
	width:90px;
	}

	button{
	background: #0079C1;
	background: url('data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/Pgo8c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgdmlld0JveD0iMCAwIDEgMSIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSI+CiAgPGxpbmVhckdyYWRpZW50IGlkPSJncmFkLXVjZ2ctZ2VuZXJhdGVkIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjAlIiB5MT0iMCUiIHgyPSIwJSIgeTI9IjEwMCUiPgogICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iIzAwNzljMSIgc3RvcC1vcGFjaXR5PSIxIi8+CiAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiMwMDU1OWQiIHN0b3Atb3BhY2l0eT0iMSIvPgogIDwvbGluZWFyR3JhZGllbnQ+CiAgPHJlY3QgeD0iMCIgeT0iMCIgd2lkdGg9IjEiIGhlaWdodD0iMSIgZmlsbD0idXJsKCNncmFkLXVjZ2ctZ2VuZXJhdGVkKSIgLz4KPC9zdmc+');
	background: -moz-linear-gradient(top, #0079C1 0%, #00559D 100%);
	background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#0079C1), color-stop(100%,#00559D));
	background: -webkit-linear-gradient(top, #0079C1 0%,#00559D 100%);
	background: -o-linear-gradient(top, #0079C1 0%,#00559D 100%);
	background: -ms-linear-gradient(top, #0079C1 0%,#00559D 100%);
	background: linear-gradient(to bottom, #0079C1 0%,#00559D 100%);
	-webkit-border-radius: .3em;
	-moz-border-radius: .3em;
	border-radius: .3em;
	font-size: 10px;
	text-align: center;
	vertical-align: middle;
	height: 3em;
	padding-left: .9em;
	padding-right: .9em;
	border: .1em solid #00559D;
	color: white;
	cursor: pointer;
	position: relative;
	overflow: visible;
	}
	#allcontent:hover{
	background: #004C99;
	}


	.linetitle{
	display:block;
	width:632px;
	height:4px;
	margin-bottom:20px;
	}

	.linevideo{
	width:632px;
	height:4px;
	display:block;
	margin-bottom:23px;
	}
	.sites-embed-align-left-wrapping-off{
	display: block;
	clear: both;
	text-align: left;
	margin: 5px auto 5px 0;
	width: 650px;
	}

	#dateVideo{
	color:#71777F;
	font-size:11px;
	float:left;
	margin-top:0px;
	margin-left:0px;
	}
	#userVideo{
	color:#71777F;
	font-size:11px;
	float:left;
	margin-left:3px;
	margin-top:0px;
	}
    #emailTo{
	width:607px;
	height:32px;
	font-size:12px;
	font-family:BBVA Web Book, Arial;
	margin-left:10px;
	color:#71777F;

	}
	#emailTo a{
	font-size:12px;
	font-family:BBVA Web Book, Arial;
	color:#0065B7;
    }

    #icons {
    }

    .description, .smalldescription {
        color: #71777F;
        clear:both;
        font-size: 11px;
        margin-top: 30px;
        line-height: 20px;
        margin-bottom: 10px;
    }

    /*aqui*/
	#userBBVA{
		float:left;
		margin-left:15px;
		width:620px;
	}
	#userBBVA img{
	    float:left;
		margin:3px 10px 15px 0;
		width:595px;
		height:410px;
	}
	#citaAutor{

	color:#3D85C6;
	font-size:small;
	font-style:italic;
	margin-bottom:15px;
	width:615px;
	}
	#autorydpt{
	font-size:small;
	color:#666;
	font-style:italic;
	font-weight:bold;
	width:620px;

	}
	#listportales{
	width:620;
	}
	.titlesection{
	font-size:small;
	margin-right: 10px;
	margin-left: 5%;
	margin-top: 2%;
	color:#0B5394;
	}
	#reto{
	font-size:small;
	color:#3D85C6;
	margin-bottom:15px;
	}
	#resultados,
	#beneficios ul li{
	font-size:small;
	color:#666;
	margin-left:30px;
	}
	 .titlesection #video span{
	margin-bottom:10px;
    }
    #video {
        clear:both;
    }
	#video iframe{
	margin:0;
	}
	</style>

<div id="listportales"></div>

   <script type="text/javascript">
	 var gadgetHelper = null;
	 var prefs = new _IG_Prefs();
	 var urlTable = prefs.getString("_table_query_url");
	 var emailTo = prefs.getString("emailTo");
	 var portalContenido = gadgets.util.getUrlParameters()["parent"].split("=");
	 var situation = gadgets.util.getUrlParameters()["parent"];
	 _IG_RegisterOnloadHandler(loadVisualizationAPI);

	 function loadVisualizationAPI()
			{
				google.load("visualization", "1", {"packages": ["table"]});
				google.setOnLoadCallback(sendQuery);
			}

		function sendQuery()
			{
				gadgetHelper = new google.visualization.GadgetHelper();
				var opts = {dataType:'jsonp'};
				var query = new google.visualization.Query(urlTable, opts);
				var querytosend = "select * where A like '%"+portalContenido[1]+"%' ";
				query.setQuery(querytosend);
				query.send(handleQueryResponse);


			}
		function handleQueryResponse(response) {
			   data = response.getDataTable();
			   var filas = data.getNumberOfRows();
			   var html = "";
			   html += "<div id='titlecomboVideo'><h2>"+data.getValue(0,1)+"</h2></div><img src='https://github.com/sopraux/gsites/raw/menu/evolucionaDigital/img/lineborder.png' class='linetitle'/>";

			for(var i=0; i<filas;i++){
                html +="<div id='userBBVA'>";
                html += getIcons(data, i);
                html +="<div id='dateVideo'>"+data.getValue(i,2)+" - </div>";
                html +="<div id='userVideo'>"+data.getValue(i,5)+"</div>";
                html +="<div class='smalldescription'>"+data.getValue(i,3)+"</div>";
                html +="<div id='video'>";
                if(data.getValue(i,7) != null && typeof data.getValue(i,7) != 'undefined' && data.getValue(i,7) !== undefined && data.getValue(i,7) != ""){
                    html += "<iframe src='"+data.getValue(i,7)+"'   allowfullscreen='true' allowScriptAccess='always' style='border:0px solid #AAA; width:600px; height:400px; '></iframe>";
                }else{
                    html +="<img src='"+data.getValue(i,6)+"' />";
			    }
                html += "</div>";
                html += "<div class='description'>"+data.getValue(i,4)+"</div>";
			    html +="</div>";
			}
				document.getElementById('listportales').innerHTML = html;
                }

        function getIcons(data, row) {
            var html = "<div class='icons'>";
                var iconCols = {
                9: 'https://raw.githubusercontent.com/sopraux/gsites/ED-novedades/evolucionaDigital/img/accion.png',
                10: 'https://raw.githubusercontent.com/sopraux/gsites/ED-novedades/evolucionaDigital/img/accion.png',
                11:'https://raw.githubusercontent.com/sopraux/gsites/ED-novedades/evolucionaDigital/img/accion.png',
                12: 'https://raw.githubusercontent.com/sopraux/gsites/ED-novedades/evolucionaDigital/img/accion.png',
                13:'https://raw.githubusercontent.com/sopraux/gsites/ED-novedades/evolucionaDigital/img/accion.png'
             };
            console.log('before for');
            for (var column in iconCols) {
            console.log('columna '+column);
                if (iconCols.hasOwnProperty(column)) {
                    if (data.getValue(row, column) === 'x') {
                        console.log('entro if');
                        html += "<div class='icon'><img src='"+iconCols[column]+"' /></div>";
                    }
                }
            }
            html += "</div>";
            return html;
        }




  </script>
    ]]>
  </Content>

</Module>
