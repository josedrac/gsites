<?xml version="1.0" encoding="UTF-8" ?> 
<Module>
  <ModulePrefs title="etiquetasBasico.xml"
    description=""
    author_affiliation="Capgemini">
    <Require feature="idi"/>
    <Require feature="locked-domain" />
	<Require feature="dynamic-height"/>   
	<Require feature="setprefs" />   
  </ModulePrefs>
<UserPref name="urlTableguias" default_value="" display_name="Data source url guias(Ej:https://docs.google.com/spreadsheet/ccc?key=0AoYEewut2JmZdG5HM2VLTTdwQUlLdmhnMk1DLXBWZl)" required="true" />
<UserPref name="urlTablecontenidos" default_value="" display_name="Data source url contenidos  (Ej:https://docs.google.com/spreadsheet/ccc?key=0AoYEewut2JmZdG5HM2VLTTdwQUlLdmhnMk1DLXBWZl)" required="true" />
<UserPref name="urlTableexitos" default_value="" display_name="Data source url exitos (Ej:https://docs.google.com/spreadsheet/ccc?key=0AoYEewut2JmZdG5HM2VLTTdwQUlLdmhnMk1DLXBWZl)" required="true" />
<UserPref name="urlTablemovilidad" default_value="" display_name="Data source url movilidad (Ej:https://docs.google.com/spreadsheet/ccc?key=0AoYEewut2JmZdG5HM2VLTTdwQUlLdmhnMk1DLXBWZl)" required="true" />
 <Content type="html" charset="UTF-8">
    <![CDATA[
	<script src="https://www.google.com/jsapi" type="text/javascript"></script>
	
	<style type="text/css">
	  /* @group fonts */
@font-face {
	font-family: 'BBVA Web Light';
	src:url('https://bbvaportaldeayuda.googlecode.com/svn/trunk/fonts/web-light/web-light.eot');
	src:url('https://bbvaportaldeayuda.googlecode.com/svn/trunk/fonts/web-light/web-light.eot?iefix') format("embedded-opentype"),
		url('https://bbvaportaldeayuda.googlecode.com/svn/trunk/fonts/web-light/web-light.woff') format("woff"),
		url('https://bbvaportaldeayuda.googlecode.com/svn/trunk/fonts/web-light/web-light.ttf') format("truetype"),
		url('https://bbvaportaldeayuda.googlecode.com/svn/trunk/fonts/web-light/web-light.svg#BBVA Web Light') format("svg");
	font-style: normal;
	font-weight: normal;
}

@font-face {
	font-family: 'BBVA Web Book';
	src:url('https://bbvaportaldeayuda.googlecode.com/svn/trunk/fonts/web-book/web-book.eot');
	src:url('https://bbvaportaldeayuda.googlecode.com/svn/trunk/fonts/web-book/web-book.eot?iefix') format("embedded-opentype"),
		url('https://bbvaportaldeayuda.googlecode.com/svn/trunk/fonts/web-book/web-book.woff') format("woff"),
		url('https://bbvaportaldeayuda.googlecode.com/svn/trunk/fonts/web-book/web-book.ttf') format("truetype"),
		url('https://bbvaportaldeayuda.googlecode.com/svn/trunk/fonts/web-book/web-book.svg#BBVA Web Book') format("svg");
	font-style: normal;
	font-weight: normal;
}


/* @end */
	
	#nivel{
	
	color:#0078D2;
	font-family: BBVA Web Light, Arial;
	font-size:22px;
	margin-bottom:6px;
	padding-top:23px;
	height:30px;
	margin-left:14px;
	margin-top:-27px;
	}
	
	.linedowntitle{
	margin-bottom:20px;
	width:939px;
	display:block;
	}
	.linedowntitlenivel{
	margin-bottom:20px;
	width:619px;
	display:block;
	height:1px;
	}
	.linedownheadertable{
	margin-bottom:45px;
	width:690px;
	display:block;
	}
	#titleproduct{
	margin-bottom:10px;
	}
  
	#titleproduct a{
	color:#0078D2;
	font-size:16px;
	font-family: BBVA Web Book, Arial;
	margin-left:14px;
	margin-bottom:10px;
	text-decoration:none;
	}
	#textproduct{
	color:#434A58;
	font-size:14px;
	font-family: Arial;
    width:600px;	
	margin-left:14px;
	margin-bottom:10px;
	}
	.lineproduct{
	margin-bottom:20px;
	width:619px;
	display:block;
	
	}
	
	
	.bloqueAnterior{
            clear:both;
            display:block;
            margin-left:15px;
            font-family: BBVA Web Book;
			color:#0078D2;
			float:left;
			margin-top:-2px;
			border:none;
			outline: none;
			text-decoration:none;
        }

    .bloqueSiguiente{
            display:block;
            font-family: BBVA Web Book;
            float:left;
            margin-top:0px;
            padding-left:10px;
			color:#0078D2;
			width:64px;
			border:none;
			outline: none;
			text-decoration:none;
        }
	p.text {	 
            font-size: 0.8em;
            color: #3B3B3B;
        }

  #bloqueEnlaces1 img{
            
			
			padding-right:10px;
			border:none;
			outline: none;
			text-decoration:none;
        }
	#etiquetas{
	width:651px;
	}
	.checkpage{
    margin-top:-5px;
	border:none;
	outline: none;
	text-decoration:none;
	}	
	.checkpage1{
    margin-top:-5px;
	border:none;
	outline: none;
	text-decoration:none;
	}		
	.checkpage a{
	height:9px;
	float:left;
	padding-top:4px;
	padding-left:2px;
	padding-right:2px;
	}
	.checkpage1 a{
	height:9px;
	float:left;
	padding-top:4px;
	padding-left:2px;
	padding-right:2px;
	}
	img{
	border:0px;
	text-decoration:none;
	}
	</style>
<!--[if IE]>
<style type="text/css">
.bloqueAnterior{
            clear:both;
            display:block;
            margin-left:15px;
			margin-top:-5px;
            font-family: BBVA Web Book;
			color:#0078D2;
			float:left;
			border:none;
			outline: none;
			text-decoration:none;
			margin-right:10px;
        }
		</style>
<![endif]-->		
<div id="nivel"></div>
<img src="https://bbvaportaldeayuda.googlecode.com/svn/trunk/img/linepagetitledown.png" class="linedowntitlenivel" />
<div id="etiquetas"></div>
	
   <script type="text/javascript">
     if (!Array.prototype.indexOf) {
		Array.prototype.indexOf = function (searchElement /*, fromIndex */ ) {
        "use strict";
        if (this == null) {
            throw new TypeError();
        }
        var t = Object(this);
        var len = t.length >>> 0;
        if (len === 0) {
            return -1;
        }
        var n = 0;
        if (arguments.length > 0) {
            n = Number(arguments[1]);
            if (n != n) { // shortcut for verifying if it's NaN
                n = 0;
            } else if (n != 0 && n != Infinity && n != -Infinity) {
                n = (n > 0 || -1) * Math.floor(Math.abs(n));
            }
        }
        if (n >= len) {
            return -1;
        }
        var k = n >= 0 ? n : Math.max(len - Math.abs(n), 0);
        for (; k < len; k++) {
            if (k in t && t[k] === searchElement) {
                return k;
            }
        }
        return -1;
    }
} 
	 var gadgetHelper = null;
	 var prefs = new _IG_Prefs();
	 
	 var urlTableguias = prefs.getString("urlTableguias");
	 var urlTablecontenidos = prefs.getString("urlTablecontenidos");
	 var urlTableexitos = prefs.getString("urlTableexitos");
	 var urlTablemovilidad = prefs.getString("urlTablemovilidad");
	 var tag = gadgets.util.getUrlParameters()["parent"].split("=");
	 var TotalFilas = 0;
	 var aux = new Array();
	 var auxtexto = new Array();
	 var auxurl = new Array();
	 var auxsubsection = new Array();
	 var tagAux = "";
	 tag[1]=tag[1].replace(/\+/g,' ');
	 tagAux = decodeURIComponent(tag[1]);
	 
	 document.getElementById('nivel').innerHTML = tagAux;
	 
	 _IG_RegisterOnloadHandler(loadVisualizationAPI);
	 function loadVisualizationAPI() 
			{
				google.load("visualization", "1", {"packages": ["table"]});
				google.setOnLoadCallback(sendQuery);
			}
	 function sendQuery() 
			{
				gadgetHelper = new google.visualization.GadgetHelper();
				var opts = {dataType:'jsonp'};		
				var query = new google.visualization.Query(urlTableguias, opts);					
			   
				var querytosend = "select D,H,J,C where (I like '%"+tagAux+"%') or (E like '%"+tagAux+"%') or (F like '%"+tagAux+"%')";
				
				query.setQuery(querytosend);			  
				query.send(handleQueryResponse);
				
				
			}
	 function handleQueryResponse(response) {
				data = response.getDataTable();	
				var filas = data.getNumberOfRows();
				TotalFilas +=filas;
				var titulo = new Array();
				var texto = new Array(); 
				var url = new Array();  
				var subsection="";
				
				for(var i=0;i<filas;i++){
				   
				   titulo[i] = data.getValue(i,0);
				   texto[i]= data.getValue(i,2);
				   url[i] = data.getValue(i,1);
				   subsection = data.getValue(i,3);
					  if(aux.indexOf(titulo[i])== -1){ 
							aux += titulo[i]+"|";
							auxtexto[titulo[i]]= texto[i];
							auxurl[titulo[i]]= url[i];
						    aux[titulo[i]]= subsection;
						}else if((aux.indexOf(titulo[i])!= -1)&&(aux[titulo[i]]!=subsection)){
							aux += titulo[i]+"|";
							auxtexto[titulo[i]]= texto[i];
							auxurl[titulo[i]]= url[i];
						    aux[titulo[i]]= subsection;
						}
					 }
				var opts = {dataType:'jsonp'};
				var querycontenidos = new google.visualization.Query(urlTablecontenidos, opts);	
			    var querytosendcontenidos = "select B,Q,D where (E like '%"+tagAux+"%') or (K like '%"+tagAux+"%') or (L like '%"+tagAux+"%')";
				querycontenidos.setQuery(querytosendcontenidos);	
				querycontenidos.send(handleQueryResponse2); 
			}
			
	  function handleQueryResponse2(response) {
				data = response.getDataTable();	
				var filas = data.getNumberOfRows();
				TotalFilas +=filas;
				var titulo = new Array();
				var texto = new Array(); 
				var url = new Array(); 
				
				
				for(var i=0;i<filas;i++){
				   
				   titulo[i] = data.getValue(i,0);
				   texto[i]= data.getValue(i,2);
				   url[i] = data.getValue(i,1);
					  if(aux.indexOf(titulo[i])== -1){ 
							aux += titulo[i]+"|";
							auxtexto[titulo[i]]= texto[i];
							auxurl[titulo[i]]= url[i];
						
						}else if((aux.indexOf(titulo[i])== -1)&&(aux[titulo[i]]!=subsection)){
							aux += titulo[i]+"|";
							auxtexto[titulo[i]]= texto[i];
							auxurl[titulo[i]]= url[i];
						    aux[titulo[i]]= subsection;
						}
					 }
				var opts = {dataType:'jsonp'};
				var querycontenidos = new google.visualization.Query(urlTableexitos, opts);	
			    var querytosendcontenidos = "select B,O,D where N like '%"+tagAux+"%'";
				querycontenidos.setQuery(querytosendcontenidos);	
				querycontenidos.send(handleQueryResponse3); 
			}	
		 function handleQueryResponse3(response) {
				data = response.getDataTable();	
				var filas = data.getNumberOfRows();
				TotalFilas +=filas;
				var titulo = new Array();
				var texto = new Array(); 
				var url = new Array();  
				
				
				for(var i=0;i<filas;i++){
				   
				   titulo[i] = data.getValue(i,0);
				   texto[i]= data.getValue(i,2);
				   url[i] = data.getValue(i,1);
					  if(aux.indexOf(titulo[i])== -1){ 
							aux += titulo[i]+"|";
							auxtexto[titulo[i]]= texto[i];
							auxurl[titulo[i]]= url[i];
						
						}
					 }
				var opts = {dataType:'jsonp'};
				var querycontenidos = new google.visualization.Query(urlTablemovilidad, opts);	
			    var querytosendcontenidos = "select G,F,I where H  like '%"+tagAux+"%'";
				querycontenidos.setQuery(querytosendcontenidos);	
				querycontenidos.send(handleQueryResponse4); 
			}		
		function handleQueryResponse4(response) {
				data = response.getDataTable();	
				var filas = data.getNumberOfRows();
				TotalFilas +=filas;
				var titulo = new Array();
	            var texto = new Array(); 
				var url = new Array();  
				
				
				for(var i=0;i<filas;i++){
				   
				   titulo[i] = data.getValue(i,0);
				   texto[i]= data.getValue(i,2);
				   url[i] = data.getValue(i,1);
					  if(aux.indexOf(titulo[i])== -1){ 
							aux += titulo[i]+"|";
							auxtexto[titulo[i]]= texto[i];
							auxurl[titulo[i]]= url[i];
						
						}
					 }
				mostrar()
			}
	function mostrar(){
	            var aux1= aux.split("|");
				//console.debug(aux1.length);
	            var filas = aux1.length-1;
				var pagTotales = Math.ceil(filas/5);
				var pagActual = 1;
				var html = "";
				
				
				
				if(filas<1)
					{
						html += '<p class="text">No hay ningï¿½n contenido con este Nivel.</p>';
					}
				else
					{               
						html += '<div id="pagina1" class="paginaNueva" style=" display: block;width: auto;height: 660px;">';
					}
				for(var i=0;i<filas;i++){
				 html +="<div id='titleproduct'><a target='_parent' href='"+auxurl[aux1[i]]+"'>"+aux1[i]+"</a></div>";  
				 html +="<div id='textproduct'>"+auxtexto[aux1[i]]+"</div>";
				 html +="<img src='https://bbvaportaldeayuda.googlecode.com/svn/trunk/img/linepagetitledown.png' class='lineproduct' />";
				   
				   if(pagTotales>1){
			      
				  if (i==5*pagActual-1){
				  
				    var pagActualParaMostrar = pagActual+1;
                    var pagSiguiente = pagActualParaMostrar+1;
					
					if(i>2){
					 html += '<div id="bloqueEnlaces1" class="bloqueAnterior"><a href="javascript:anterior(\''+ pagActualParaMostrar +'\');"><img src="https://bbvaportaldeayuda.googlecode.com/svn/trunk/img/anterior.png" /></a></div>';
					}
					
					for(var j=1;j<=pagTotales;j++){
					if ((j==pagActual) && (j==1)){
					   	html += '<div id="paginas1" class="checkpage1"><a href="javascript:changePage(\''+ j +'\',\''+ pagActual +'\');"><img src="https://bbvaportaldeayuda.googlecode.com/svn/trunk/img/paginaHover.png" id="pagination'+j+'"/></a></div>';

					}
					else if(j==pagActual){
					    html += '<div id="paginas" class="checkpage"><a href="javascript:changePage(\''+ j +'\',\''+ pagActual +'\');"><img src="https://bbvaportaldeayuda.googlecode.com/svn/trunk/img/paginaHover.png" id="pagination'+j+'"/></a></div>';
					  }else{
					    html += '<div id="paginas" class="checkpage"><a onclick="javascript:changeImage(\''+ j +'\',\''+ pagActual +'\')" href="javascript:changePage(\''+ j +'\',\''+ pagActual +'\');"><img src="https://bbvaportaldeayuda.googlecode.com/svn/trunk/img/pagina.png" id="pagination'+j+'"/></a></div>';

					  }
					}
					if(pagActual!=pagTotales){
					html += '<div id="bloqueEnlaces"  class="bloqueSiguiente"><a href="javascript:continuacion(\''+ pagActualParaMostrar +'\');"><img src="https://bbvaportaldeayuda.googlecode.com/svn/trunk/img/siguiente.png" /> </a></div>';}
                    html += '</div>';
                    html += '<div id="pagina'+ pagActualParaMostrar +'" class="paginaNueva" style="display:none; width: auto;height: 660px;">';
			        
			        pagActual++;
					
					}
					else if(i==filas-1)
                    {    			
				        //console.debug('ANTERIOR>');
						var pagActualAux = pagActual;
				        pagActual--;
						
					    html += '<div id="bloqueEnlaces1" class="bloqueAnterior"><a href="javascript:anteriorUltima(\''+ pagActualParaMostrar +'\');"><img src="https://bbvaportaldeayuda.googlecode.com/svn/trunk/img/anterior.png" /></a></div>';
						for(var j=1;j<=pagTotales;j++){
							if(j==pagActualAux){
								html += '<div id="paginas" class="checkpage"><a onclick="javascript:changeImage(\''+ j +'\',\''+ pagActualAux +'\')" href="javascript:changePage(\''+ j +'\',\''+ pagActualAux +'\');"><img src="https://bbvaportaldeayuda.googlecode.com/svn/trunk/img/paginaHover.png" id="pagination'+j+'"/></a></div>';
							}else{
								html += '<div id="paginas" class="checkpage"><a onclick="javascript:changeImage(\''+ j +'\',\''+ pagActualAux +'\')" href="javascript:changePage(\''+ j +'\',\''+ pagActualAux +'\');"><img src="https://bbvaportaldeayuda.googlecode.com/svn/trunk/img/pagina.png" id="pagination'+j+'"/></a></div>';
							}
						}
						html += '</div>';
				    }			
                }	
				   
				   
				   
			}
				
		document.getElementById('etiquetas').innerHTML += html;
	
		
	}
	
	function continuacion(num)
        {           
            var bloque = "pagina"+num;
            var numInt = parseInt(num)-1;
            var bloque_anterior = "pagina"+ numInt;           
            document.getElementById(bloque).style.display='block';
            document.getElementById(bloque_anterior).style.display='none';
        }

    	function anterior(num)
        {           
            var bloque = "pagina"+num;
            var numInt = parseInt(num)-1;
            var numInt2 = parseInt(num)-2;
            if (numInt2 == 0)
            {
                numInt  = 2;
                numInt2 = 1;
            }
            var bloque_actual = "pagina"+ numInt;
            var bloque_anterior = "pagina"+ numInt2;
            document.getElementById(bloque_actual).style.display='none';
            document.getElementById(bloque_anterior).style.display='block';
			document.getElementById('pagination'+numInt).src="https://bbvaportaldeayuda.googlecode.com/svn/trunk/img/pagina.png";
		    document.getElementById('pagination'+numInt2).src="https://bbvaportaldeayuda.googlecode.com/svn/trunk/img/paginaHover.png";
        }

    	function anteriorUltima(num)
        {
            var bloque = "pagina"+num;
            var numInt = parseInt(num)-1;
            var bloque_anterior = "pagina"+ numInt;
            document.getElementById(bloque).style.display='none';
            document.getElementById(bloque_anterior).style.display='block';
			document.getElementById('pagination'+num).src="https://bbvaportaldeayuda.googlecode.com/svn/trunk/img/pagina.png";
		    document.getElementById('pagination'+numInt).src="https://bbvaportaldeayuda.googlecode.com/svn/trunk/img/paginaHover.png";
    	}
		function changePage(num,pag){
		
		    var bloque = "pagina"+pag;
			//var numInt = parseInt(num)-1;
			var bloque_anterior = "pagina"+ num;
			
		    document.getElementById(bloque).style.display='none';
            document.getElementById(bloque_anterior).style.display='block';
		}
		function changeImage(pagina,old){
		//alert("pagina "+pagina);
		//alert("pagina "+old);
		    document.getElementById('pagination'+old).src="https://bbvaportaldeayuda.googlecode.com/svn/trunk/img/pagina.png";
		    document.getElementById('pagination'+pagina).src="https://bbvaportaldeayuda.googlecode.com/svn/trunk/img/paginaHover.png";
		}	
			
	</script>
   
    ]]>
  </Content>
  
</Module>