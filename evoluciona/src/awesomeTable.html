<script src="https://cdn.rawgit.com/sopraux/gsites/v1.0/newstycbbvaespana/js/jquery.min.js" type="text/javascript"></script>
<script src="https://cdn.rawgit.com/sopraux/gsites/v1.0/newstycbbvaespana/js/unslider.min.js" type="text/javascript"></script>
<script src="https://cdn.rawgit.com/sopraux/gsites/v1.0/evolucionaDigital/js/smartpaginator.js" type="text/javascript"></script>
<script src="https://www.google.com/jsapi" type="text/javascript"></script>
<script src="scripts/dlbScriptCrossBrowser.js" language="javascript" type="text/javascript"></script>


<style type="text/css">
  /* @group fonts */
  
  @font-face {
    font-family: 'BBVA Web Light';
    src: url('https://cdn.rawgit.com/sopraux/gsites/v1.0/newstycbbvaespana/fonts/web-light/web-light.eot');
    src: url('https://cdn.rawgit.com/sopraux/gsites/v1.0/newstycbbvaespana/fonts/web-light/web-light.eot?iefix') format("embedded-opentype"), url('https://cdn.rawgit.com/sopraux/gsites/v1.0/newstycbbvaespana/fonts/web-light/web-light.woff') format("woff"), url('https://cdn.rawgit.com/sopraux/gsites/v1.0/newstycbbvaespana/fonts/web-light/web-light.ttf') format("truetype"), url('https://cdn.rawgit.com/sopraux/gsites/v1.0/newstycbbvaespana/fonts/web-light//web-light.svg#BBVA Web Light') format("svg");
    font-style: normal;
    font-weight: normal;
  }
  
  @font-face {
    font-family: 'BBVA Web Book';
    src: url('https://cdn.rawgit.com/sopraux/gsites/v1.0/newstycbbvaespana/fonts/web-book/web-book.eot');
    src: url('https://cdn.rawgit.com/sopraux/gsites/v1.0/newstycbbvaespana/fonts/web-book/web-book.eot?iefix') format("embedded-opentype"), url('https://cdn.rawgit.com/sopraux/gsites/v1.0/newstycbbvaespana/fonts/web-book/web-book.woff') format("woff"), url('https://cdn.rawgit.com/sopraux/gsites/v1.0/newstycbbvaespana/fonts/web-book/web-book.ttf') format("truetype"), url('https://cdn.rawgit.com/sopraux/gsites/v1.0/newstycbbvaespana/fonts/web-book/web-book.svg#BBVA Web Book') format("svg");
    font-style: normal;
    font-weight: normal;
  }
  
  @font-face {
    font-family: 'BBVA Web Medium';
    src: url('https://cdn.rawgit.com/sopraux/gsites/v1.0/newstycbbvaespana/fonts/web-medium/web-medium.eot');
    src: url('https://cdn.rawgit.com/sopraux/gsites/v1.0/newstycbbvaespana/fonts/web-medium/web-medium.eot?iefix') format("embedded-opentype"), url('https://cdn.rawgit.com/sopraux/gsites/v1.0/newstycbbvaespana/fonts/web-medium/web-medium.woff') format("woff"), url('https://cdn.rawgit.com/sopraux/gsites/v1.0/newstycbbvaespana/fonts/web-medium/web-medium.ttf') format("truetype"), url('https://cdn.rawgit.com/sopraux/gsites/v1.0/newstycbbvaespana/fonts/web-medium/web-medium.svg#BBVA Web Medium') format("svg");
    font-style: normal;
    font-weight: normal;
  }
  /* @end */
  /*CSS: */
  .clearfix {
		overflow: auto;
	}
	
/*	.container {
		font-family: arial, sans-serif;
		font-size: 12px;
		margin-bottom: 16px;
		position: relative;
		width: 460px;
	}*/
	
	.datesandtags {
		display: inline-block;
		float: left;
		margin-right: 10px;
		width: 150px;
	}
	
	.datesandtags .start,
	.datesandtags .end {
		border-radius: 4px 4px 4px 4px;
		color: #FFFFFF;
		float: left;
		left: 9px;
		margin-bottom: 6px;
		padding: 4px 10px;
		text-align: center;
		width: 45px;
		padding-top: 0px;
	}
	
	.datesandtags .start {
		background: none repeat scroll 0 0 #018DF5;
	}
	
	.datesandtags .end {
		background: none repeat scroll 0 0 #0560BD;
	}
	
	.day {
		font-size: 30px;
	}
	
	.month,
	.year {
		font-size: 18px;
		font-family: BBVA Web Book, Arial;
	}
	
	.iconArrow {
		margin-right: 5px;
		margin-left: 5px;
		display: table-cell;
		vertical-align: middle;
		float: left;
		margin-top: 25;
	}
	
	.icon {
		display: inline-block;
		float: left;
		width: 24px;
		text-align: center;
	}
	
	.info {
		margin-left: 7px;
		display: inline-block;
		width: 265px;
	}
	
	.title {
		font-size: 18px;
		font-family: BBVA Web Book, Arial;
		color: #0078D2;
		font-weight: bold;
		overflow: hidden;
		display: block;
	}
	
	.assistants {
		color: #71777F;
		font-size: 11px;
		font-family: Arial;
		margin-bottom: 15px;
		line-height: 18px;
		width: 100%;
	}
	
	.assistant {
		width: 100%;
		float: left;
	}
	
	.place {
		color: #434A58;
		font-size: 13px;
		font-family: Arial;
		line-height: 18px;
	}
	
	.place span {
		font-size: 13px;
		font-family: Arial;
		color: #0065B7;
		line-height: 2px;
	}
	
	.description {
		color: #434A58;
		font-size: 12px;
		font-family: Arial;
		margin-top: 20px;
		line-height: 18px;
		max-height: 36px;
		text-overflow: ellipsis;
		display: block;
		overflow: hidden;
	}
	
	hr {
		width: 610px;
		margin-bottom: 20px;
		margin-left: -1px;
		color: #DCDCDC;
	}
	
	/*button:hover {
		background: #004C99;
	}
	
	button {
		background: #0079C1;
		background: url('data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/Pgo8c3ZnIHhtbG5zPSJoâ€¦iIGhlaWdodD0iMSIgZmlsbD0idXJsKCNncmFkLXVjZ2ctZ2VuZXJhdGVkKSIgLz4KPC9zdmc+');
		background: -moz-linear-gradient(top, #0079C1 0%, #00559D 100%);
		background: -webkit-gradient(linear, left top, left bottom, color-stop(0%, #0079C1), color-stop(100%, #00559D));
		background: -webkit-linear-gradient(top, #0079C1 0%, #00559D 100%);
		background: -o-linear-gradient(top, #0079C1 0%, #00559D 100%);
		background: -ms-linear-gradient(top, #0079C1 0%, #00559D 100%);
		background: linear-gradient(to bottom, #0079C1 0%, #00559D 100%);
		-webkit-border-radius: .3em;
		-moz-border-radius: .3em;
		border-radius: .3em;
		text-align: center;
		font-size: 12px;
		vertical-align: middle;
		height: 1.75em;
		padding-left: .9em;
		padding-right: .9em;
		padding-bottom: 2px;
		border: .1em solid #00559D;
		color: white;
		cursor: pointer;
		position: relative;
		text-align: center;
		vertical-align: middle;
		margin-right: 22px;
		margin-bottom: 20px;
		margin-top: 20px;
		margin-left: 0px;
		float: left;
		font-family: BBVA Web Light, Arial;
		font-weight: bold;
	}*/
	
	.paginaNueva {
		width: auto;
	}
	
	.lineinfo {
		width: 100%;
		height: 4px;
		display: block;
		margin-bottom: 20px;
	}
	
	.sites-embed-align-left-wrapping-off {
		display: block;
		clear: both;
		text-align: left;
		margin: 5px auto 5px 0;
		width: 650px;
	}
	
	p.text {
		font-size: 0.8em;
		color: #3B3B3B;
	}
	
	.youtubeIframe {
		display: none;
	}
	
	.pager {
		height: 30px;
		text-align: center;
		width: 175px;
		display: table;
	}
	
	.pager ul {
		list-style: none;
		padding: 0;
		margin: 0;
		text-aling: center;
		display: table-cell;
		vertical-align: middle;
	}
	
	.pager ul li {
		display: inline;
		margin-left: 2px;
	}
	
	.pager ul li a {
    text-decoration: none;
    font-weight: bold;
    display: inline-table;
    width: 20px;
    height: 18px;
    text-align: center;
    border-radius: 4px;
    -moz-border-radius: 4px;
  }
	
	.pager span {
		margin-left: 4px;
		color: White;
		float: left;
	}
	
	.pager .btn {
		width: 40px;
		text-align: center;
		display: table-cell;
		vertical-align: middle;
	}
	
	.pager .disabled {
		color: #A0A0A0 !important;
		text-shadow: 1px 1px 1px #FFFFFF;
	}
	
	.black.normal {
		background-color: #FFFFFF;
		color: #0072C9;
		border: solid 1px #d2e5eb;
	}
	
	.black.active {
		background-color: #0072C9;
		color: #FFFFFF;
		border: solid 1px #0072C9;
	}
  .banner {
    position: relative;
    margin: 0 auto;
    border-radius: 1px;
    max-width: 960px!important;
    width: auto!important;
    min-height: 418px!important;
    border: 1px solid #D1D1D1;
  }
  
  .banner #titleCarousel {
    font-size: 20px;
    padding: 20px 15px;
    color: #0072c9;
    font-family: 'BBVA Web Light';
    
  }

  div #titleCarousel{
    padding: 0;
  }

  ul{
    padding-left: 0;
    margin-bottom: 0;
    margin-top: 0;
  }
  /*.banner ul {
    margin: 0;
    padding: 0;
    min-height: 418px!important;
  }
  */
  
  .banner ul li {
    position: relative;
    display: block;
    float: left;
    margin: 0;
    background-size: cover;
    background-position: center;
  }
  
  .control {
    position: absolute;
    width: 100%;
    text-align: center;
    bottom: 0;
    border-top: 1px solid #E6EEF5;
    margin-bottom: 8px;
  }
  
  .control .prev {
    margin-right: 13px;
  }
  
  .control .next {
    margin-left: 13px;
  }
  
/*  .container {
    font-family: arial, sans-serif;
    font-size: 12px;
    margin-bottom: 16px;
    position: relative;
    width: 460px;
  }*/
  
  .headerTable {
    background-color: #f0f0f0;
    color: black;
    text-align: center;
  }
  
  .style-text {
    text-align: left;
    color: rgb(0, 158, 229);
  }
  
  .style-text1 {
    text-align: center;
    color: rgb(9, 79, 164);
  }
  
  table {
    border-collapse: collapse;
    width: 100%;
  }
  
  td,
  th {
    border: 1px solid #eee;
    text-align: left;
    padding: 8px;
  }
  
  tr:nth-child(2n+1) {
    background-color: #dddddd;
  }
  
  tr:hover {
    background-color: skyblue;
  }
  
  #myInput {
    background-image: url(/css/searchicon.png);
    background-position: 10px 12px;
    background-repeat: no-repeat;
    width: 17%;
    font-size: 16px;
    padding: 12px 20px 12px 40px;
    border: 1px solid #ddd;
    margin-bottom: 12px;
    line-height: 31px;
    padding-left: 4px;
    font-size: 14px;
    margin: 2px;
    height: 31px;
    width: 166px;
    float: left;
}
  #selectCategory {
    background-image: url(/css/searchicon.png);
    background-position: 30px 22px;
    background-repeat: no-repeat;
    width: 17%;
    font-size: 16px;
    padding: 12px 20px 12px 40px;
    border: 1px solid #ddd;
    margin-bottom: 12px;
    background-color: #f5f5f5;
    border: 1px solid rgba(0,0,0,.1);
    background-color: #f5f5f5;
    color: #444;
    display: flex;
    padding: 3px 8px;
    vertical-align: middle;
    /* float: right; */
    float: right;
    margin-right: 79%;
    margin-top: 2px;
    height: 31px;
    width: 166px;
}

#myUL {
    /* Remove default list styling */
    list-style-type: none;
    padding: 0;
    margin: 0;
}

#myUL tr th {
    border: 1px solid #ddd; /* Add a border to all links */
    margin-top: -1px; /* Prevent double borders */
    background-color: #f6f6f6; /* Grey background color */
    padding: 12px; /* Add some padding */
    text-decoration: none; /* Remove default text underline */
    font-size: 18px; /* Increase the font-size */
    color: black; /* Add a black text color */
    display: block; /* Make it into a block element to fill the whole list */
}

#myUL tr th.header {
    background-color: #e2e2e2; /* Add a darker background color for headers */
    cursor: default; /* Change cursor style */
}

#myUL tr th:hover:not(.header) {
    background-color: #eee; /* Add a hover effect to all links, except for headers */
}

.style-filter-button{
    display: flex;
    vertical-align: middle;
    padding: .2em;
    margin: .2em;
    height: auto!important;
    line-height: 1.3em!important;
    color: #4b4a4d;
    background-color: #F5F5F5;
    border: 1px solid #DDD;
    border-radius: 2px;
    width: 9.7%;
    margin-left: 178px;
    float: right;
    margin-right: 79%;
    margin-top: 2px;
    height: 31px;
    width: 149px;
    border: 1px solid rgba(0,0,0,.1);
    background-color: #f5f5f5;
    color: #444;
    display: flex;
    padding: 3px 8px;
    vertical-align: middle;
    margin-bottom: 5px;
}

.style-filter-button:hover{
  border: 1px solid #a3b9e6;
}

.style-filters{
  display: block;
}
</style>


<script type="text/javascript">
  google.load('visualization', '1', { packages: ['table'] });

</script>

<div class="style-filters">
  <input type="text" id="myInput" onkeyup="search()" placeholder="BUSCADOR">
  <select id="selectCategory" onclick="filterF()">
              <option value="">Nombre DT</option>
              <option value="Barcelona">Barcelona</option>
              <option value="Canarias">Canarias</option>
              <option value="Centro">Centro</option>
              <option value="Este">Este</option>
              <option value="Noroeste">Noroeste</option>
              <option value="Norte">Norte</option>
              <option value="Sur">Sur</option>
              <option value="Todas las DTÂ´s">Todas las DTÂ´s</option>
  </select>
  <div id="filterF"></div>
</div>


  <div id="titleCarousel"></div>
  <ul id="carousel"></ul>



<!--<div id="container" class="container">-->
  <div id="listImplantaciones"></div>
  <!--<div id="not-found"></div>-->
<!--</div>-->


<script type="text/javascript">
  var dataForm = {
    /*'key': prefs.getString('spreadsheetKey'),*/	 //xml
    'key': getParam('key'),			                  //local - get key in url
    'numberTab': 0
  };
  var titleHtml = "";
  var html = "";
  var gadgetHelper = null;
  //var prefs = new gadgets.Prefs();
  //var TitleCarousel = prefs.getString("TitleCarousel");
  var TitleCarousel = "";
  var html = "";
  var gadgetHelper = null;
  var listF = [];
  var dataIni;
  var data = [];
  var spreadsheetKey = getParam('key'),
    queryString = encodeURIComponent('SELECT * where E = "' + getUrlParameter("date") + '"'),
    sheetName = encodeURIComponent('carousel territorial'),
    query = new google.visualization.Query('https://spreadsheets.google.com/tq?key=' + spreadsheetKey + '&sheet=' + sheetName + '&tq=' + queryString);


  $.ajax({
    type: 'GET',
    url: 'https://script.google.com/a/macros/bbva.com/s/AKfycbyPKcDJzBWVSlwWOugDVov87-_xXlEFfWXa7adIswtNXNtM-mdv/exec',
    data: dataForm,
    dataType: 'jsonp',
    crossDomain: true,
    jsonpCallback: "on_result",
    success: function (data) {
      //Delete the first row as it is not necessary
      data.splice(0, 4);
    
      dataIni = data.slice();
      handleQueryResponse(dataIni);
    },
    error: function () {
      console.log('error');
    }
  });


  function handleQueryResponse(dataIni) {
    var html = "";
    var filas = dataIni.length;

    //alert(response.getDetailedMessage());
    if (filas < 1) {
      /*console.log('Error in query: ' + response.getMessage() + ' ' + response.getDetailedMessage());*/
      console.log("Lo sentimos no hay noticiaxs disponibles");
      html += '<p class="not-found">No hay ningÃºn contenido disponible.</p>';
      /*   document.getElementById('not-found').innerHTML = html;*/
      return;
    }else{
      html += '<div id="paginas" class="paginaNueva" style=" display: block; overflow: hidden;">';
    
      data = dataIni.slice();
      data.length ? printDataTable(data) : console.log('spreadsheet is empty');

      html += '</div>';
    }
    html += "<div id='pagination' style='margin: auto;'></div>";

    document.getElementById('listImplantaciones').innerHTML += html;
    if (filas > 0) 
      pagination(filas);
  }


//Search:
function search() {
    // Declare variables
    var input, filter, ul, li, a, i;
    input = document.getElementById('myInput');
    filter = input.value.toUpperCase();
    table = document.getElementById("myTable");
    tr = table.getElementsByTagName("tr");
    /*li = ul.getElementsByTagName('th');*/

    // Loop through all list items, and hide those who don't match the search query
    for (i = 0; i < tr.length; i++) {
      td = tr[i].getElementsByTagName("td")[0];
      if (td) {
        if (td.innerHTML.toUpperCase().indexOf(filter) > -1) {
          tr[i].style.display = "";
        } else {
          tr[i].style.display = "none";
        }
      }       
    }
  }


//filter - Search :
function filterF(){
  var html = '';
  var e = document.getElementById("selectCategory");
  var strUser = e.options[e.selectedIndex].value;

  /*Show view*/
  if(strUser != "" && listF.indexOf(strUser) == -1){
    listF.push(strUser);
    console.log("listF: " + listF);
    listF.forEach(function(filter, index) {
      html += "<div class='style-filter-button' onclick='remove("+index+")'><i>x</i><div>" + "   " + filter +"</div></div>";
      document.getElementById('filterF').innerHTML = html;
    });
    /*Filter:*/
    printDataTable(dataIni);
    pagination(dataIni.length);
  } 
}

//remove filter
function remove(i){
  html = "";
  listF.splice(i, 1);
  console.log("remove - listF: " + listF);
  if(listF.length != 0){
    for(i=0; i< listF.length; i++){
      html += "<div class='style-filter-button' onclick='remove("+i+")'><i>x</i><div>" + "   " + listF[i] +"</div></div>";
      document.getElementById('filterF').innerHTML = html;
    }
  }else{
      document.getElementById('filterF').innerHTML = '';
  }
  data = dataIni.slice();
  printDataTable(dataIni);
  pagination(dataIni.length);
}


function getParam(p) {
  var params;
  /*if (gadgets.util.getUrlParameters().parent.split("?").length > 1) {*/
  if (window.location.href.split("?").length > 1) {
    /*params = gadgets.util.getUrlParameters().parent.split("?")[1].split("&");*/
    params = window.location.href.split("?")[1].split("&");
    for (var i = 0; i < params.length; i++) {
      if (params[i].split("=")[0] == p)
        return params[i].split("=")[1];
    }
  }
  return "";
}


//Pagination
function pagination(elements) {
  $('#pagination').smartpaginator({
    totalrecords: elements,
    recordsperpage: 10,
    length: 4,
    datacontainer: 'myTable',
    dataelement: 'tr.hover-style',
    initval: 0,
  });
}


  function getUrlParameter(parameterName) {
    var params = window.location.search.substr(1).split('&');
    for (var i = 0; i < params.length; i++) {
      var p = params[i].split('=');
      if (p[0] == parameterName) {
        return decodeURIComponent(p[1]);
      }
    }
    return false;
  }


  function capitalLetter(string){
    return string.charAt(0).toUpperCase() + string.slice(1);
  }


  function printDataTable(dataTable) {
    console.log("DataTable: " + dataTable.length);    //213
    var title, subtitle, html = "";
    var dataFilter = [];
    data = [];
    
    //Header:
    html += "<div class='eventContainer'>";
    html += "<table id='myTable'>";
    html += " <tr class='headerTable'>";
    html += "   <th style='width:60%' class='headerTable'>Nombre</th>";
    html += "   <th style='width:40%' class='headerTable'>Alcance</th>";
    html += " <tr>";
    //Data according filters
   
    data = filterData(dataTable, listF);
   
    /*for (var i = 0; i < dataTable.getNumberOfRows(); i++) {*/
    data.forEach(function(elem) {
      html += printRow(elem[2], elem[3]);
    });

    html += "</table>";
    html += '</div>';
    document.getElementById('carousel').innerHTML = html;
  }
  

  function filterData(data, filters) {
    if (filters.length == 0)
      return data; 
    
    filters.forEach(function(myFilter) {
      data = data.filter(function(row) {
        if (row[3].indexOf(myFilter) != -1) {
          return row;
        }
      });
    });
    return data;
  }
  


  function printRow(title, subtitle) {
    var html = "";
    html += "<tr id='myUL' class='hover-style'>";
    html += "		<td class='style-text'>" + capitalLetter(title.toLowerCase()); +/*+ " <br>" + subtitle + */"</td>";
    html += "   <td class='style-text1'>" + subtitle + "</td>";
    html += "</tr>";
    
    return html;
  }


  /*  function Go(destination) {
      window.parent.location.href = destination;
      return false;
    }*/

</script>