<?xml version="1.0" encoding="UTF-8" ?>
<Module>
 	<ModulePrefs title="NB-test.xml">
    	<Require feature="idi"/>
	    <Require feature="locked-domain" />
		<Require feature="dynamic-height"/>
        <Require feature="setprefs" />
  	</ModulePrefs>
    <UserPref name="spreadsheetKey"  display_name="URL Spreadsheet" required="true" />

    <Content type="html" charset="UTF-8">
    <![CDATA[
    	<script src="https://www.google.com/jsapi" type="text/javascript"></script>
        <script src="https://apis.google.com/js/auth.js?onload=init"></script>

        <script src="https://apis.google.com/js/platform.js" async defer></script>
<meta name="google-signin-client_id" content="890384802796-6k5nag1u5pd1pu219s0341ceko4rd9ui.apps.googleusercontent.com">
<div class="g-signin2" data-onsuccess="onSignIn"></div>

    	<div class="container">
    		Esto es un test!
            <button id="authorize-button" onclick=handleAuthClick>Authorize</button>
    	</div>

        <script>
        // NOTE: You must replace the client id on the following line.
        var clientId = '890384802796-6k5nag1u5pd1pu219s0341ceko4rd9ui.apps.googleusercontent.com';
        var scopes = 'https://spreadsheets.google.com/feeds';

        function init() {
          gapi.auth.authorize({client_id: clientId, scope: scopes, immediate: true},handleAuthResult);
        }

        function handleAuthResult(authResult) {
          var authorizeButton = document.getElementById('authorize-button');
          if (authResult && !authResult.error) {
            authorizeButton.style.visibility = 'hidden';
          } else {
            authorizeButton.style.visibility = '';
            authorizeButton.onclick = handleAuthClick;
          }
        }

        function handleAuthClick(event) {
          gapi.auth.authorize(
              {client_id: clientId, scope: scopes, immediate: false},
              handleAuthResult);
          return false;
        }
        </script>

        <script type="text/javascript">
            google.load('visualization', '1', {packages: ['table']});
        </script>

        <script type="text/javascript">

            var prefs = new gadgets.Prefs(),
                spreadsheetKey = prefs.getString('spreadsheetKey'),
                sectionId = prefs.getString('sectionId'),
                queryString = encodeURIComponent('SELECT *'),
                query = new google.visualization.Query('https://spreadsheets.google.com/tq?key=' + spreadsheetKey + '&tq=' + queryString + '&access_token=' + encodeURIComponent(gapi.auth.getToken().access_token));

            function getSpreadsheet() {
                query.send(handleQueryResponse);
            }

            function handleQueryResponse(response) {
                console.log('llega');
                if (response.isError()) {
                    console.log('Error in query: ' + response.getMessage() + ' ' + response.getDetailedMessage());
                    return;
                }
            }

            google.setOnLoadCallback(getSpreadsheet);

        </script>
    ]]>
  	</Content>
</Module>
