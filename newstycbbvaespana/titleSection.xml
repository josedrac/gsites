<?xml version="1.0" encoding="UTF-8" ?>
<Module>
  <ModulePrefs title="NB - titleSection.xml">
    <Require feature="idi"/>
    <Require feature="locked-domain" />
	<Require feature="dynamic-height"/>
	<Require feature="setprefs" />
  </ModulePrefs>
<UserPref name="sectionId" display_name="Section ID" required="true" />

 <Content type="html">
    <![CDATA[
		<script type="text/javascript" src="https://www.google.com/jsapi"></script>
		<script type="text/javascript" src="https://cdn.rawgit.com/sopraux/gsites/master/gsites-components/js/functionHelpers.js"></script>

		<style type="text/css">

			@font-face {
		        font-family: 'BBVA Web Light';
		        src:url('https://rawgit.com/sopraux/gsites/master/newstycbbvaespana/fonts/web-light/web-light.eot');
		        src:url('https://rawgit.com/sopraux/gsites/master/newstycbbvaespana/fonts/web-light/web-light.eot?iefix') format("embedded-opentype"),
		            url('https://rawgit.com/sopraux/gsites/master/newstycbbvaespana/fonts/web-light/web-light.woff') format("woff"),
		            url('https://rawgit.com/sopraux/gsites/master/newstycbbvaespana/fonts/web-light/web-light.ttf') format("truetype"),
		            url('https://rawgit.com/sopraux/gsites/master/newstycbbvaespana/fonts/web-light//web-light.svg#BBVA Web Light') format("svg");
		        font-style: normal;
		        font-weight: normal;
		    }

			#sectionId {
				border-bottom: 1px solid #DCDCDC;
			}

			h2, img {
		  		font-family:"BBVA Web Light",arial,sans-serif;
		  		font-weight: lighter;
		  		
		  		color: #0078D2;
		  		font-size: 22px;
		  		padding-bottom: 9px;
				margin: 0;
			}

		</style>
		<script type="text/javascript">

			google.load('visualization', '1', {packages: ['table']});

		</script>

		<script type="text/javascript">

			var prefs = new gadgets.Prefs(),
				sectionId = prefs.getString('sectionId'),
				spreadsheetKey = '1Iv72DC3co0yfP70TaxSxru6BFNfXkBjGss_8LMDwZ_Q',
				sheetName = encodeURIComponent('sections'),
				queryString = encodeURIComponent('SELECT * where A = "'+sectionId+'"'),
				query = new google.visualization.Query('https://spreadsheets.google.com/tq?key=' + spreadsheetKey + '&sheet=' + sheetName + '&tq=' + queryString);

			function getSpreadsheet() {
				query.send(handleQueryResponse);
			}

			function handleQueryResponse(response) {
				if (response.isError()) {
					console.log('Error in query: ' + response.getMessage() + ' ' + response.getDetailedMessage());
					return;
				}
				var dataTable = response.getDataTable();
				dataTable.getNumberOfRows() ? printDataTable(dataTable) : console.log('spreadsheet is empty');
			}

			function printDataTable(dataTable) {
				var name = dataTable.getValue(0, 1),
					image = dataTable.getValue(0, 2);

				var html = "";

				if(image != undefined) {
					html += '<img src="' + image + '" alt="image"/>';
				} 
				else if(name != null) {
					html += '<h2>'+ name +'</h2>';
				}

				document.getElementById("sectionId").innerHTML = html;
				
			}

		</script>

		<body onload="adjustGadgetHeight('sectionId')">
			<div id="sectionId"></div>

			<script type="text/javascript">google.setOnLoadCallback(getSpreadsheet);</script>
		</body>


    ]]>
  </Content>
  <Content type="html" view="configuration">

<![CDATA[
	<style type="text/css">
	 	table td {
			color: #000;
			font-size: 11px;
			font-weight: bold;
		}
	 </style>
	 <table width="100%" border="0" id="tablaconfig">
		<tr>
	       <td>
	           Id -Page: <input type="text" size="100" id="sectionId" value="__UP_sectionId__"   onchange="register('sectionId')"/>
	       </td>
	    </tr>
	</table>

	<script type="text/javascript">

	    var prefs = new gadgets.Prefs();
	    function register(variable) {
	        prefs.set(variable, document.getElementById(variable).value);
	    }

		gadgets.window.adjustHeight();

	</script>

 ]]>
 </Content>
</Module>
