<script src="https://www.google.com/jsapi" type="text/javascript"></script>
<script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>

<style type="text/css">
	/* @group fonts */
	
	@font-face {
		font-family: 'BBVA Web Light';
		src: url('https://cdn.rawgit.com/sopraux/gsites/v1.0/newstycbbvaespana/fonts/web-light/web-light.eot');
		src: url('https://cdn.rawgit.com/sopraux/gsites/v1.0/newstycbbvaespana/fonts/web-light/web-light.eot?iefix') format("embedded-opentype"), url('https://cdn.rawgit.com/sopraux/gsites/v1.0/newstycbbvaespana/fonts/web-light/web-light.woff') format("woff"), url('https://cdn.rawgit.com/sopraux/gsites/v1.0/newstycbbvaespana/fonts/web-light/web-light.ttf') format("truetype"), url('https://cdn.rawgit.com/sopraux/gsites/v1.0/newstycbbvaespana/fonts/web-light//web-light.svg#BBVA Web Light') format("svg");
		font-style: normal;
		font-weight: normal;
	}
	
	@font-face {
		font-family: 'BBVA Web Book';
		src: url('https://cdn.rawgit.com/sopraux/gsites/v1.0/newstycbbvaespana/fonts/web-book/web-book.eot');
		src: url('https://cdn.rawgit.com/sopraux/gsites/v1.0/newstycbbvaespana/fonts/web-book/web-book.eot?iefix') format("embedded-opentype"), url('https://cdn.rawgit.com/sopraux/gsites/v1.0/newstycbbvaespana/fonts/web-book/web-book.woff') format("woff"), url('https://cdn.rawgit.com/sopraux/gsites/v1.0/newstycbbvaespana/fonts/web-book/web-book.ttf') format("truetype"), url('https://cdn.rawgit.com/sopraux/gsites/v1.0/newstycbbvaespana/fonts/web-book/web-book.svg#BBVA Web Book') format("svg");
		font-style: normal;
		font-weight: normal;
	}
	
	@font-face {
		font-family: 'BBVA Web Medium';
		src: url('https://cdn.rawgit.com/sopraux/gsites/v1.0/newstycbbvaespana/fonts/web-medium/web-medium.eot');
		src: url('https://cdn.rawgit.com/sopraux/gsites/v1.0/newstycbbvaespana/fonts/web-medium/web-medium.eot?iefix') format("embedded-opentype"), url('https://cdn.rawgit.com/sopraux/gsites/v1.0/newstycbbvaespana/fonts/web-medium/web-medium.woff') format("woff"), url('https://cdn.rawgit.com/sopraux/gsites/v1.0/newstycbbvaespana/fonts/web-medium/web-medium.ttf') format("truetype"), url('https://cdn.rawgit.com/sopraux/gsites/v1.0/newstycbbvaespana/fonts/web-medium/web-medium.svg#BBVA Web Medium') format("svg");
		font-style: normal;
		font-weight: normal;
	}
	/* @end */
	
	button {
		background: #0079C1;
		background: url('data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/Pgo8c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgdmlld0JveD0iMCAwIDEgMSIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSI+CiAgPGxpbmVhckdyYWRpZW50IGlkPSJncmFkLXVjZ2ctZ2VuZXJhdGVkIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjAlIiB5MT0iMCUiIHgyPSIwJSIgeTI9IjEwMCUiPgogICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iIzAwNzljMSIgc3RvcC1vcGFjaXR5PSIxIi8+CiAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiMwMDU1OWQiIHN0b3Atb3BhY2l0eT0iMSIvPgogIDwvbGluZWFyR3JhZGllbnQ+CiAgPHJlY3QgeD0iMCIgeT0iMCIgd2lkdGg9IjEiIGhlaWdodD0iMSIgZmlsbD0idXJsKCNncmFkLXVjZ2ctZ2VuZXJhdGVkKSIgLz4KPC9zdmc+');
		background: -moz-linear-gradient(top, #0079C1 0%, #00559D 100%);
		background: -webkit-gradient(linear, left top, left bottom, color-stop(0%, #0079C1), color-stop(100%, #00559D));
		background: -webkit-linear-gradient(top, #0079C1 0%, #00559D 100%);
		background: -o-linear-gradient(top, #0079C1 0%, #00559D 100%);
		background: -ms-linear-gradient(top, #0079C1 0%, #00559D 100%);
		background: linear-gradient(to bottom, #0079C1 0%, #00559D 100%);
		-webkit-border-radius: .3em;
		-moz-border-radius: .3em;
		border-radius: .3em;
		font-size: 10px;
		text-align: center;
		vertical-align: middle;
		padding-right: 0.9em;
		padding-left: 0.9em;
		border: .1em solid #00559D;
		color: white;
		cursor: pointer;
		position: relative;
		overflow: visible;
		width: auto;
		font-size: 11px;
		height: 30px;
		font-weight: bold;
		text-decoration: none;
	}
	
	.banner {
		position: relative;
		overflow: hidden;
		margin: 0 auto;
		border-radius: 1px;
		width: 960px;
	}
	
	.banner ul {
		margin: 0;
		padding: 0;
	}
	
	.banner ul li {
		position: relative;
		display: block;
		float: left;
		margin: 0;
		padding: 0;
		height: 295px;
		background-size: cover;
		background-position: center;
		border-top: 10px solid #0091E5;
	}
	
	.banner ul li .content {
		width: 273px;
		height: 195px;
		background-color: white;
		margin-left: 80px;
		margin-top: 20px;
		padding: 15px;
		overflow: hidden;
		color: #0072c9;
	}
	
	.banner ul li .content h2 {
		margin: 0;
		font-size: 30px;
		font-family: BBVA Web Book;
		font-weight: normal;
	}
	
	.banner ul li .content p {
		font-size: 18px;
		margin: 15px 0;
		font-family: BBVA Web Light;
	}
	
	.banner .dots {
		display: inline-block;
		padding: 0;
	}
	
	.banner .dots li {
		display: inline-block;
		width: 10px;
		height: 10px;
		margin: 0 7px;
		text-indent: -999em;
		background: #4096d7;
		border-radius: 6px;
		cursor: pointer;
	}
	
	.banner .dots li.active {
		background: #003f8d;
		opacity: 1;
	}
	
	.control {
		position: absolute;
		width: 100%;
		text-align: center;
		bottom: 0;
	}
	
	.control .prev {
		margin-right: 13px;
	}
	
	.control .next {
		margin-left: 13px;
	}
</style>

<script src="https://cdn.rawgit.com/sopraux/gsites/v1.0/newstycbbvaespana/js/jquery.min.js" type="text/javascript"></script>
<script src="https://cdn.rawgit.com/sopraux/gsites/v1.0/newstycbbvaespana/js/unslider.min.js" type="text/javascript"></script>
<script src="https://cdn.rawgit.com/sopraux/gsites/v1.0/gsites-components/js/functionHelpers.js" type="text/javascript"></script>
<script type="text/javascript">
	google.load('visualization', '1', { packages: ['table'] });

</script>

<body id="container">

	<div class="banner">
		<ul id="carousel"></ul>
		<div id="carouselControls"></div>
	</div>

	<div id="functionsContainer"></div>

</body>

<script type="text/javascript">
	/*adjustGadgetHeight("container");*/

</script>

<script type="text/javascript">
	var html = "";
	/*	var gadgetHelper = null;*/

	var dataForm = {
		/*'key': prefs.getString('spreadsheetKey'),*/								//xml
		'key': '1mWS9MUphhwt3CQCRF_q_FMGzPnyYioChMUbrs5giHcY',			//local -norte
		'numberTab': 4
	};

	$.ajax({
		type: 'GET',
		url: 'https://script.google.com/a/macros/bbva.com/s/AKfycbyPKcDJzBWVSlwWOugDVov87-_xXlEFfWXa7adIswtNXNtM-mdv/exec',
		data: dataForm,
		dataType: 'jsonp',
		crossDomain: true,
		jsonpCallback: "on_result",
		success: function (data) {
			//Eliminamos la primera fila ya que no es necesaria 
			data.splice(0, 1);

			handleQueryResponse(data);
		},
		error: function () {
			console.log('error');
		}
	});


	/*	var prefs = new gadgets.Prefs(),
			 spreadsheetKey = prefs.getString('spreadsheetKey'),
			 queryString = encodeURIComponent('SELECT * where F = "' + getParam("date") + '"'),
			 sheetName = encodeURIComponent('carousel'),
			 query = new google.visualization.Query('https://spreadsheets.google.com/tq?key=' + spreadsheetKey + '&sheet=' + sheetName + '&tq=' + queryString);*/

	function getParam(p) {
		var params;
		/*if(gadgets.util.getUrlParameters().parent.split("?").length > 1){*/
		if (location.href.split("?").length > 1) {
			/*params = gadgets.util.getUrlParameters().parent.split("?")[1].split("&");*/
			params = location.href.split("?")[1].split("&");
			for (var i = 0; i < params.length; i++) {
				if (params[i].split("=")[0] == p)
					return params[i].split("=")[1];
			}
		}
		return "";
	}

	function getSpreadsheet(data) {
		/*query.send(handleQueryResponse);*/
		handleQueryResponse(data);
	}

	function handleQueryResponse(data) {
		if (!data.length) {
			/*console.log('Error in query: ' + response.getMessage() + ' ' + response.getDetailedMessage());*/
			console.log('Error in query');
			return;
		}
		var dataTable = data;
		dataTable.length ? printDataTable(dataTable) : console.log('spreadsheet is empty');
	}

	function printDataTable(dataTable) {
		console.log("printDataTable: " + dataTable);
		var title, subtitle, link, image, buttonLabel, html = "";
		console.log("*****");
		console.log(dataTable.length);

		if (dataTable.length > 1) {
			var carouselControls = '';
			carouselControls += '<div class="control">';
			carouselControls += '<a href="#" class="unslider-arrow prev"><img src="https://raw.githubusercontent.com/sopraux/gsites/master/newstycbbvaespana/img/anterior.png"></a>';
			carouselControls += '<a href="#" class="unslider-arrow next"><img src="https://raw.githubusercontent.com/sopraux/gsites/master/newstycbbvaespana/img/siguiente.png"></a>';
			carouselControls += '</div>';
			document.getElementById('carouselControls').innerHTML += carouselControls;

		}
		
		/*for(var i=0; i<dataTable.getNumberOfRows() ;i++){*/
		dataTable = dataTable.forEach(function (elem) {
			title = elem[0];
			subtitle = elem[1];
			link = elem[2];
			image = elem[3];
			buttonLabel = elem[4];

			html += "<li style='background-image: url(\"" + image + "\");'>";
			html += "	<div class='content'>";
			html += "		<h2>" + title + "</h2>";
			html += "    	<p>" + subtitle + "</p>";
			html += "		<button onclick=javascript:Go('" + link + "')>" + buttonLabel + "</button>";
			html += "	</div>";
			html += "</li>";
		});
		/*}*/




		document.getElementById('carousel').innerHTML += html;

		//Aplicar las funciones despues de renderizar los elementos para que la altura no sea nula.
		var unslider = $('.banner').unslider({
			speed: 500,
			delay: 5000,
			dots: true,
		});

		$('.unslider-arrow').click(function () {
			var fn = this.className.split(' ')[1];
			unslider.data('unslider')[fn]();
		});

		$('.prev').after($('.dots'));
		}

		google.setOnLoadCallback(getSpreadsheet);


		function Go(destination) {
		window.open(destination, '_parent');
		return false;
	}

</script>