<html>
	<script src="https://www.google.com/jsapi" type="text/javascript"></script>
    <script src="https://cdn.rawgit.com/josedrac/gsites/test-oauth/evolucionaDigital/js/environment.js" type="text/javascript"></script>
    <script src="https://cdn.rawgit.com/sopraux/gsites/v1.0/evolucionaDigital/js/jquery.min.js" type="text/javascript"></script>
	<script src="https://cdn.rawgit.com/sopraux/gsites/v1.0/evolucionaDigital/js/smartpaginator.js" type="text/javascript"></script>

    <style type="text/css">
        /* @group fonts */
        @font-face {
            font-family: 'BBVA Web Light';
            src:url('https://github.com/sopraux/gsites/raw/menu/evolucionaDigital/fonts/web-light/web-light.eot');
            src:url('https://github.com/sopraux/gsites/raw/menu/evolucionaDigital/fonts/web-light/web-light.eot?iefix') format("embedded-opentype"),
                url('https://github.com/sopraux/gsites/raw/menu/evolucionaDigital/fonts/web-light/web-light.woff') format("woff"),
                url('https://github.com/sopraux/gsites/raw/menu/evolucionaDigital/fonts/web-light/web-light.ttf') format("truetype"),
                url('https://github.com/sopraux/gsites/raw/menu/evolucionaDigital/fonts/web-light/web-light.svg#BBVA Web Light') format("svg");
            font-style: normal;
            font-weight: normal;
        }

        @font-face {
            font-family: 'BBVA Web Book';
            src:url('https://github.com/sopraux/gsites/raw/menu/evolucionaDigital/fonts/web-book/web-book.eot');
            src:url('https://github.com/sopraux/gsites/raw/menu/evolucionaDigital/fonts/web-book/web-book.eot?iefix') format("embedded-opentype"),
                url('https://github.com/sopraux/gsites/raw/menu/evolucionaDigital/fonts/web-book/web-book.woff') format("woff"),
                url('https://github.com/sopraux/gsites/raw/menu/evolucionaDigital/fonts/web-book/web-book.ttf') format("truetype"),
                url('https://github.com/sopraux/gsites/raw/menu/evolucionaDigital/fonts/web-book/web-book.svg#BBVA Web Book') format("svg");
            font-style: normal;
            font-weight: normal;
        }

        @font-face {
            font-family: 'BBVA Web Medium';
            src:url('https://github.com/sopraux/gsites/raw/menu/evolucionaDigital/fonts/web-medium/web-medium.eot');
            src:url('https://github.com/sopraux/gsites/raw/menu/evolucionaDigital/fonts/web-medium/web-medium.eot?iefix') format("embedded-opentype"),
                url('https://github.com/sopraux/gsites/raw/menu/evolucionaDigital/fonts/web-medium/web-medium.woff') format("woff"),
                url('https://github.com/sopraux/gsites/raw/menu/evolucionaDigital/fonts/web-medium/web-medium.ttf') format("truetype"),
                url('https://github.com/sopraux/gsites/raw/menu/evolucionaDigital/fonts/web-medium/web-medium.svg#BBVA Web Medium') format("svg");
            font-style: normal;
            font-weight: normal;
        }
        /* @end */

        button{
            background: #0079C1;
            background: url('data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/Pgo8c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgdmlld0JveD0iMCAwIDEgMSIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSI+CiAgPGxpbmVhckdyYWRpZW50IGlkPSJncmFkLXVjZ2ctZ2VuZXJhdGVkIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjAlIiB5MT0iMCUiIHgyPSIwJSIgeTI9IjEwMCUiPgogICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iIzAwNzljMSIgc3RvcC1vcGFjaXR5PSIxIi8+CiAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiMwMDU1OWQiIHN0b3Atb3BhY2l0eT0iMSIvPgogIDwvbGluZWFyR3JhZGllbnQ+CiAgPHJlY3QgeD0iMCIgeT0iMCIgd2lkdGg9IjEiIGhlaWdodD0iMSIgZmlsbD0idXJsKCNncmFkLXVjZ2ctZ2VuZXJhdGVkKSIgLz4KPC9zdmc+');
            background: -moz-linear-gradient(top, #0079C1 0%, #00559D 100%);
            background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#0079C1), color-stop(100%,#00559D));
            background: -webkit-linear-gradient(top, #0079C1 0%,#00559D 100%);
            background: -o-linear-gradient(top, #0079C1 0%,#00559D 100%);
            background: -ms-linear-gradient(top, #0079C1 0%,#00559D 100%);
            background: linear-gradient(to bottom, #0079C1 0%,#00559D 100%);
            -webkit-border-radius: .3em;
            -moz-border-radius: .3em;
            border-radius: .3em;
            font-size: 10px;
            text-align: center;
            vertical-align: middle;
            height: 2em;
            padding-left: .9em;
            padding-right: .9em;
            border: .1em solid #00559D;
            color: white;
            cursor: pointer;
            position: relative;
            overflow: visible;
        }

        .container-table {
            width: 100%;
        }

        #tableHeader {
            margin-top: 10px;
        }

        .headerText {
            margin-top: 5px;
            font-size: 12px;
            font-weight: bold;
            text-align: center;
            color: #434a58;
        }

        .headerImg {
            margin-top: 10px;
            margin: 10px 3px 0;
        }

        .colHeader {
            width: 8%;
            height: 85px;
            float: left;
            border-right: 1px solid #E5E5E5;
            border-top: 1px solid #E5E5E5; border-bottom: 1px solid #E5E5E5; background-color: #F8F8F5;
            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
            box-sizing: border-box;
        }

        .firstcol {
            width: 36% !important;
            border-left: 0;
        }

        .firstcol img {
            display: none;
        }

        .text {
            line-height: 15px;
            vertical-align: middle;
            display: table-cell;
            text-align: left;
        }

        .colBody {
            width: 8%;
            float:left;
            color: #434a58;
            display: table;
            height: 36px;
            border-bottom: 1px solid #E5E5E5;
            text-align: center;
            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
            box-sizing: border-box;
        }

        .colBodyIcon {
            height: 25px;
        }

        .colBodyIcon .center {
            width: 100%;
        }

        .row {
            clear: both;
            font-size: 12px;
            width: 100%;
            border-bottom: 1px solid #E5E5E5;
            overflow: hidden;
        }

        .rowTitle {
            clear: both;
            width: 100%;
            margin-top: 20px;
            font-weight: bold;
            font-size: 13px;
            color: #434a58;
            margin-bottom: 5px;
        }

        .rowTitle td{
            padding-top: 20px;
        }

        #lastcol {
            border-right: 0 !important;
            margin-bottom: 10px;
        }

        .centerText {
            text-align:center;
            margin-top:11px;
        }

        span.click {
            color: #0078d2;
            text-decoration: none;
            cursor: pointer;
        }

        .controls {
            text-align: right;
            max-width: 969px;
            padding: 0 10px 5px 0;
        }
    </style>

    <div class="table-container">
        <table id="initiatives_table" class="table">
            <thead id="initiatives_table_header" class="table__header">

            </thead>

            <tbody  id="initiatives_table_body" class="table__body">

            </tbody>
        </table>

		<div id='pagination' class="pagination" style='margin: auto;'></div>
    </div>

    <script type="text/javascript">
        var html = '',
            params = {
				globalSearch: {	},
				nameInitiative: {
					col: 'D'
				},
				description: {
					col: 'E'
				},
				goal: {
					col: 'B'
				},
				status: {
					col: 'H'
				},
				category: {
					col: 'C'
				},
				valueRelated: {
					col: 'F'
				}
			},
			tableCols = [
				{
					header: 'País',
					sheetIndex: 17
				},
				{
					header: 'Nombre',
					sheetIndex: 3
				},
				{
					header: 'Descripción',
					sheetIndex: 4
				},
				{
					header: 'Objetivo',
					sheetIndex: 1
				},
				{
					header: 'Categoría',
					sheetIndex: 2
				},
				{
					header: 'Estado',
					sheetIndex: 7
				},
				{
					header: 'Enlace al repositorio',
					sheetIndex: 9
				}
			],
			gadgetHelper = null,
	        urlTable = prefs.getString('_table_query_url'),
            imgRootPath = 'https://raw.githubusercontent.com/sopraux/gsites/master/evolucionaDigital/img/'


		initFilterParams();
		_IG_RegisterOnloadHandler(loadVisualizationAPI);


	 	function loadVisualizationAPI() {
			google.load("visualization", "1", {"packages": ["table"]});
			google.setOnLoadCallback(sendQuery);
		}

        function pagination(elements) {
	        $('#pagination').smartpaginator({
		        totalrecords: elements,
		        recordsperpage: 4,
		        length: 4,
		        datacontainer: 'paginas',
		        dataelement: 'div.comboVideo',
		        initval: 0,
	        });
	     }

         function getQueryParameters() {
     		var filter 	= '',
				cols 	= 'BCDEFGHIJPQRST';

     		if (isSearchDone()) {
				Object.keys(params).forEach(function(key) {
					var param = params[key];
					if (param.value) {
						if (key === 'globalSearch') {
							return cols.forEach(function(col) {
								filter += ' AND (lower('+ col +') contains lower("' + param.value + '"))';
							});
						}
						filter += ' AND (lower('+ param.col +') contains lower("' + param.value + '"))';
					}
                });
 			}

			return filter;
     	}

        function sendQuery() {

            var request = function (authorized_url){
                var opts = { dataType: 'jsonp' },
                	query = new google.visualization.Query(authorized_url, opts),
                	querytosend = "select * where A == ''";

    			querytosend = querytosend.concat(getQueryParameters());
    			querytosend = querytosend.concat("offset 4 order by D desc");
                query.setQuery(querytosend);
                query.send(handleQueryResponse);
				gadgetHelper = new google.visualization.GadgetHelper();
            }

            window.Environment.sendAuthorizedQuery(urlTable, request);
        }

        function handleQueryResponse(response) {
			data = response.getDataTable();
			createHeader();
            createBody(data);
        }

        function createBody(data) {
            var numberOfRows = data.getNumberOfRows(),
				html = '';

            for (var i = 0; i < numberOfRows; i++) {
                html += '<tr class="row">';

				tableCols.forEach(function(col) {
					html +=	'<td class="colBody"><span class="text">'+ data.getValue(i, col.sheetIndex) +'</span></td>';
				});

                html += '</tr>';
            }

			$('#initiatives_table_body').innerHTML = html;
        }

        function createHeader() {
            var headerHtml = '';


            tableCols.forEach(function(item, index) {
                var headerClassModifier = '';
                if (!index) { headerClassModifier = 'table__header-col_first'; }
                if (index === headers.length-1) { headerClassModifier = 'table__header-col_last'; }

                headerHtml += 	'<th class="table__header-col '+ headerClassModifier +'">' +
                    			'	<span class="table__header-text">'+ item.header +'</span>' +
                				'</th>';
            });

            $('#initiatives_table_header').html(headerHtml);
        }

		function getUrl() {
			//return document.referrer;
			return location.href;
		}

        function isSearchDone() {
            return getUrl().split("=").length >= 2;
        }

        function initFilterParams() {
            var urlParam,
                listParams = getUrl().split('?')[1].split('&');

            listParams.forEach(function(item) {
                urlParam = item.split('=');
                params[ urlParam[0] ].value = urlParam[1];
            });
        }

        function Go(destination) {
            window.open(destination,'_parent');
            return false;
        }

    </script>
</html>
